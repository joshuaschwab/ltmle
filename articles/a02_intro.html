<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ltmle">
<title>Introduction to ltmle • ltmle</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to ltmle">
<meta property="og:description" content="ltmle">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ltmle</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3-0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/a01_overview.html">ltmle Package Overview</a>
    <a class="dropdown-item" href="../articles/a02_intro.html">Introduction to ltmle</a>
    <a class="dropdown-item" href="../articles/a03_msm.html">Marginal Structural Models - ltmleMSM</a>
    <a class="dropdown-item" href="../articles/a04_deterministic-functions.html">Deterministic Functions</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/joshuaschwab/ltmle/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction to ltmle</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/joshuaschwab/ltmle/blob/HEAD/vignettes/articles/a02_intro.Rmd" class="external-link"><code>vignettes/articles/a02_intro.Rmd</code></a></small>
      <div class="d-none name"><code>a02_intro.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/joshuaschwab/ltmle" class="external-link">ltmle</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="minimal-example">Minimal Example<a class="anchor" aria-label="anchor" href="#minimal-example"></a>
</h2>
<p>Consider the observed data with time ordering W -&gt; A -&gt; Y. W is
a continuous baseline covariate that affects A and Y. A is a binary
treatment variable that affects Y. Y is a binary outcome variable.</p>
<p>W ~ N(0, 1)</p>
<p>A ~ binomial with P(A = 1) = expit(W)</p>
<p>Y ~ binomial with P(Y = 1) = expit(W + A)</p>
<p>where <span class="math inline">\(expit(z) = \frac{1}{1 +
e^{-z}}\)</span></p>
<p>We want to know <span class="math inline">\(E[Y_1]\)</span> the
expected value of Y, intervening to set A to 1.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rexpit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">1</span>, prob<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu">rexpit</span><span class="op">(</span><span class="va">W</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu">rexpit</span><span class="op">(</span><span class="va">W</span> <span class="op">+</span> <span class="va">A</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">W</span>, <span class="va">A</span>, <span class="va">Y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;            W A Y</span></span>
<span><span class="co">#&gt; 1  0.8134167 0 0</span></span>
<span><span class="co">#&gt; 2  0.3625437 0 1</span></span>
<span><span class="co">#&gt; 3  0.6247327 0 0</span></span>
<span><span class="co">#&gt; 4  0.7721537 0 0</span></span>
<span><span class="co">#&gt; 5  1.0331531 1 1</span></span>
<span><span class="co">#&gt; 6 -0.2282334 0 0</span></span></code></pre></div>
<p>We could try to use the simple mean of Y or the mean of Y when A = 1,
but these will be biased.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.6025</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Y</span><span class="op">[</span><span class="va">A</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.7817085</span></span></code></pre></div>
<p>Now we use <code>ltmle()</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">ltmle</span><span class="op">(</span><span class="va">data</span>, Anodes <span class="op">=</span> <span class="st">"A"</span>, Ynodes <span class="op">=</span> <span class="st">"Y"</span>, abar <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Qform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for Y:</span></span>
<span><span class="co">#&gt; Q.kplus1 ~ W + A</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; gform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for A:</span></span>
<span><span class="co">#&gt; A ~ W</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span></span>
<span><span class="va">result</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ltmle(data = data, Anodes = "A", Ynodes = "Y", abar = 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; TMLE Estimate:  0.7053678</span></span></code></pre></div>
<p>Because we’re using simulated data, we can calculate the true value
of <span class="math inline">\(E[Y_1]\)</span></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n.large</span> <span class="op">&lt;-</span> <span class="fl">1e6</span></span>
<span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n.large</span><span class="op">)</span></span>
<span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu">rexpit</span><span class="op">(</span><span class="va">W</span> <span class="op">+</span> <span class="va">A</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.697166</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="single-time-point">Single time point<a class="anchor" aria-label="anchor" href="#single-time-point"></a>
</h2>
<p>Time ordering of data is W1 -&gt; W2 -&gt; W3 -&gt; A -&gt; Y</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">W1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="va">W2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, size<span class="op">=</span><span class="fl">1</span>, prob<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span>   </span>
<span><span class="va">W3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu">rexpit</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">W1</span> <span class="op">+</span> <span class="va">W3</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu">rexpit</span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">W1</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="va">W2</span> <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="va">A</span> <span class="op">+</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="va">W3</span> <span class="op">*</span> <span class="va">A</span> <span class="op">-</span> <span class="fl">1.1</span> <span class="op">*</span> <span class="va">W3</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">W1</span>, <span class="va">W2</span>, <span class="va">W3</span>, <span class="va">A</span>, <span class="va">Y</span><span class="op">)</span></span></code></pre></div>
<p>True value of <span class="math inline">\(E[Y_1]\)</span> is
approximately 0.5939.</p>
<p>SuperLearner semiparametric estimation using all parents as
regressors</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">ltmle</span><span class="op">(</span><span class="va">data</span>, Anodes<span class="op">=</span><span class="st">"A"</span>, Lnodes<span class="op">=</span><span class="cn">NULL</span>, Ynodes<span class="op">=</span><span class="st">"Y"</span>, abar<span class="op">=</span><span class="fl">1</span>, SL.library<span class="op">=</span><span class="st">"default"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required namespace: SuperLearner</span></span>
<span><span class="co">#&gt; Qform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for Y:</span></span>
<span><span class="co">#&gt; Q.kplus1 ~ W1 + W2 + W3 + A</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; gform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for A:</span></span>
<span><span class="co">#&gt; A ~ W1 + W2 + W3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Loading required package: nnls</span></span>
<span><span class="co">#&gt; Loading required namespace: arm</span></span>
<span><span class="co">#&gt; Estimate of time to completion: 1 to 2 minutes</span></span></code></pre></div>
<p>TMLE estimate:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimator:  tmle </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ltmle(data = data, Anodes = "A", Lnodes = NULL, Ynodes = "Y", </span></span>
<span><span class="co">#&gt;     abar = 1, SL.library = "default")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    Parameter Estimate:  0.61313 </span></span>
<span><span class="co">#&gt;     Estimated Std Err:  0.046501 </span></span>
<span><span class="co">#&gt;               p-value:  &lt;2e-16 </span></span>
<span><span class="co">#&gt;     95% Conf Interval: (0.52199, 0.70427)</span></span></code></pre></div>
<p>IPTW estimate:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result</span>, estimator<span class="op">=</span><span class="st">"iptw"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimator:  iptw </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ltmle(data = data, Anodes = "A", Lnodes = NULL, Ynodes = "Y", </span></span>
<span><span class="co">#&gt;     abar = 1, SL.library = "default")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    Parameter Estimate:  0.59122 </span></span>
<span><span class="co">#&gt;     Estimated Std Err:  0.030896 </span></span>
<span><span class="co">#&gt;               p-value:  &lt;2e-16 </span></span>
<span><span class="co">#&gt;     95% Conf Interval: (0.53067, 0.65177)</span></span></code></pre></div>
<p>SuperLearner semiparametric estimation using correctly specified
regressors. This passes W1^2, W2, W3, A and W3:A as columns of matrix X
to SuperLearner for the Q regression and W1 and W3 as columns of matrix
X to SuperLearner for the g regression.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">ltmle</span><span class="op">(</span><span class="va">data</span>, Anodes<span class="op">=</span><span class="st">"A"</span>, Lnodes<span class="op">=</span><span class="cn">NULL</span>, Ynodes<span class="op">=</span><span class="st">"Y"</span>, </span>
<span>                Qform<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Y<span class="op">=</span><span class="st">"Q.kplus1 ~ I(W1^2) + W2 + W3*A"</span><span class="op">)</span>, </span>
<span>                gform<span class="op">=</span><span class="st">"A ~ W1 + W3"</span>, abar<span class="op">=</span><span class="fl">1</span>, SL.library<span class="op">=</span><span class="st">"default"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimate of time to completion: 1 minute</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimator:  tmle </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ltmle(data = data, Anodes = "A", Lnodes = NULL, Ynodes = "Y", </span></span>
<span><span class="co">#&gt;     Qform = c(Y = "Q.kplus1 ~ I(W1^2) + W2 + W3*A"), gform = "A ~ W1 + W3", </span></span>
<span><span class="co">#&gt;     abar = 1, SL.library = "default")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    Parameter Estimate:  0.6325 </span></span>
<span><span class="co">#&gt;     Estimated Std Err:  0.034014 </span></span>
<span><span class="co">#&gt;               p-value:  &lt;2e-16 </span></span>
<span><span class="co">#&gt;     95% Conf Interval: (0.56584, 0.69917)</span></span></code></pre></div>
<p>glm using correctly specified Qform and gform</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">ltmle</span><span class="op">(</span><span class="va">data</span>, Anodes<span class="op">=</span><span class="st">"A"</span>, Lnodes<span class="op">=</span><span class="cn">NULL</span>, Ynodes<span class="op">=</span><span class="st">"Y"</span>, </span>
<span> Qform<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Y<span class="op">=</span><span class="st">"Q.kplus1 ~ I(W1^2) + W2 + W3*A"</span><span class="op">)</span>, gform<span class="op">=</span><span class="st">"A ~ W1 + W3"</span>, </span>
<span> abar<span class="op">=</span><span class="fl">1</span>, SL.library<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimator:  tmle </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ltmle(data = data, Anodes = "A", Lnodes = NULL, Ynodes = "Y", </span></span>
<span><span class="co">#&gt;     Qform = c(Y = "Q.kplus1 ~ I(W1^2) + W2 + W3*A"), gform = "A ~ W1 + W3", </span></span>
<span><span class="co">#&gt;     abar = 1, SL.library = NULL)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    Parameter Estimate:  0.63239 </span></span>
<span><span class="co">#&gt;     Estimated Std Err:  0.034267 </span></span>
<span><span class="co">#&gt;               p-value:  &lt;2e-16 </span></span>
<span><span class="co">#&gt;     95% Conf Interval: (0.56523, 0.69955)</span></span></code></pre></div>
<p>Get summary measures (additive treatment effect, odds ratio, relative
risk) for abar=1 vs abar=0</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">ltmle</span><span class="op">(</span><span class="va">data</span>, Anodes<span class="op">=</span><span class="st">"A"</span>, Lnodes<span class="op">=</span><span class="cn">NULL</span>, Ynodes<span class="op">=</span><span class="st">"Y"</span>, </span>
<span>                      abar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, SL.library<span class="op">=</span><span class="st">"default"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Qform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for Y:</span></span>
<span><span class="co">#&gt; Q.kplus1 ~ W1 + W2 + W3 + A</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; gform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for A:</span></span>
<span><span class="co">#&gt; A ~ W1 + W2 + W3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimate of time to completion: 1 minute</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimator:  tmle </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ltmle(data = data, Anodes = "A", Lnodes = NULL, Ynodes = "Y", </span></span>
<span><span class="co">#&gt;     abar = list(1, 0), SL.library = "default")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Treatment Estimate:</span></span>
<span><span class="co">#&gt;    Parameter Estimate:  0.61454 </span></span>
<span><span class="co">#&gt;     Estimated Std Err:  0.045844 </span></span>
<span><span class="co">#&gt;               p-value:  &lt;2e-16 </span></span>
<span><span class="co">#&gt;     95% Conf Interval: (0.52468, 0.70439) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Control Estimate:</span></span>
<span><span class="co">#&gt;    Parameter Estimate:  0.68544 </span></span>
<span><span class="co">#&gt;     Estimated Std Err:  0.027963 </span></span>
<span><span class="co">#&gt;               p-value:  &lt;2e-16 </span></span>
<span><span class="co">#&gt;     95% Conf Interval: (0.63063, 0.74024) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Additive Treatment Effect:</span></span>
<span><span class="co">#&gt;    Parameter Estimate:  -0.0709 </span></span>
<span><span class="co">#&gt;     Estimated Std Err:  0.053699 </span></span>
<span><span class="co">#&gt;               p-value:  0.18673 </span></span>
<span><span class="co">#&gt;     95% Conf Interval: (-0.17615, 0.034349) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Relative Risk:</span></span>
<span><span class="co">#&gt;    Parameter Estimate:  0.89656 </span></span>
<span><span class="co">#&gt;   Est Std Err log(RR):  0.085026 </span></span>
<span><span class="co">#&gt;               p-value:  0.19908 </span></span>
<span><span class="co">#&gt;     95% Conf Interval: (0.75894, 1.0591) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Odds Ratio:</span></span>
<span><span class="co">#&gt;    Parameter Estimate:  0.73165 </span></span>
<span><span class="co">#&gt;   Est Std Err log(OR):  0.23297 </span></span>
<span><span class="co">#&gt;               p-value:  0.17987 </span></span>
<span><span class="co">#&gt;     95% Conf Interval: (0.46345, 1.1551)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="censoring">Censoring<a class="anchor" aria-label="anchor" href="#censoring"></a>
</h2>
<p>Time ordering of data is W -&gt; C -&gt; Y. C is a censoring node.
The parameter of interest is Y, intervening to set C to be uncensored.
Censoring nodes are very similar to treatment nodes. The main difference
is that after censoring, other data is expected to be NA. It is assumed
that the parameter of interest always intervenes to set censoring nodes
to uncensored, so this is not specified in <code>abar</code>. g and Q
regressions always stratify on censoring nodes, whereas g and Q
regressions can either stratify or pool over treatment nodes (by using
the <code>stratify</code> argument.)</p>
<p>Censoring nodes in <code>data</code> should be factors with two
levels - “censored” and “uncensored”. The utility function
<code>BinaryToCensoring</code> can be used to facilitate this.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100000</span></span>
<span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BinaryToCensoring.html">BinaryToCensoring</a></span><span class="op">(</span>is.censored <span class="op">=</span> <span class="fu">rexpit</span><span class="op">(</span><span class="va">W</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">C</span><span class="op">)</span></span>
<span><span class="co">#&gt;   censored uncensored </span></span>
<span><span class="co">#&gt;      49962      50038</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">n</span><span class="op">)</span></span>
<span><span class="va">Y</span><span class="op">[</span><span class="va">C</span> <span class="op">==</span> <span class="st">"uncensored"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">rexpit</span><span class="op">(</span><span class="va">W</span><span class="op">[</span><span class="va">C</span> <span class="op">==</span> <span class="st">"uncensored"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">W</span>, <span class="va">C</span>, <span class="va">Y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="co">#&gt;               W          C  Y</span></span>
<span><span class="co">#&gt; 1  -0.401247694   censored NA</span></span>
<span><span class="co">#&gt; 2   0.344375907   censored NA</span></span>
<span><span class="co">#&gt; 3  -0.978055713 uncensored  0</span></span>
<span><span class="co">#&gt; 4  -0.576122056   censored NA</span></span>
<span><span class="co">#&gt; 5   1.168682578   censored NA</span></span>
<span><span class="co">#&gt; 6   1.763147572   censored NA</span></span>
<span><span class="co">#&gt; 7   1.450346820 uncensored  0</span></span>
<span><span class="co">#&gt; 8  -1.316843540 uncensored  0</span></span>
<span><span class="co">#&gt; 9  -0.003540234 uncensored  1</span></span>
<span><span class="co">#&gt; 10  0.179439924 uncensored  1</span></span>
<span><span class="co">#&gt; 11  0.986671190   censored NA</span></span>
<span><span class="co">#&gt; 12 -0.008727362 uncensored  1</span></span>
<span><span class="co">#&gt; 13  0.752074021   censored NA</span></span>
<span><span class="co">#&gt; 14  1.092588147   censored NA</span></span>
<span><span class="co">#&gt; 15  0.617482345 uncensored  1</span></span>
<span><span class="co">#&gt; 16 -0.682897811   censored NA</span></span>
<span><span class="co">#&gt; 17 -0.521943520   censored NA</span></span>
<span><span class="co">#&gt; 18  0.684433187 uncensored  1</span></span>
<span><span class="co">#&gt; 19  1.147623622   censored NA</span></span>
<span><span class="co">#&gt; 20  2.480473765   censored NA</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">ltmle</span><span class="op">(</span><span class="va">data</span>, Anodes <span class="op">=</span> <span class="cn">NULL</span>, Cnodes <span class="op">=</span> <span class="st">"C"</span>, Ynodes <span class="op">=</span> <span class="st">"Y"</span>, abar <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co">#&gt; Qform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for Y:</span></span>
<span><span class="co">#&gt; Q.kplus1 ~ W</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; gform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for C:</span></span>
<span><span class="co">#&gt; C ~ W</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimate of time to completion: 1 minute</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimator:  tmle </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ltmle(data = data, Anodes = NULL, Cnodes = "C", Ynodes = "Y", </span></span>
<span><span class="co">#&gt;     abar = NULL)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    Parameter Estimate:  0.49902 </span></span>
<span><span class="co">#&gt;     Estimated Std Err:  0.0023399 </span></span>
<span><span class="co">#&gt;               p-value:  &lt;2e-16 </span></span>
<span><span class="co">#&gt;     95% Conf Interval: (0.49443, 0.5036)</span></span></code></pre></div>
<p>The naive estimate is biased (the true value is 0.5):</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] NA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Y</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.413206</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="longitudinal-data">Longitudinal data<a class="anchor" aria-label="anchor" href="#longitudinal-data"></a>
</h2>
<p>Time ordering of data is W -&gt; A1 -&gt; L -&gt; A2 -&gt; Y. L is
time-dependent covariate because it occurs after a treatment (or
censoring) variable, A1. We indicate this using the <code>Lnodes</code>
argument.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="va">A1</span> <span class="op">&lt;-</span> <span class="fu">rexpit</span><span class="op">(</span><span class="va">W</span><span class="op">)</span></span>
<span><span class="va">L</span> <span class="op">&lt;-</span> <span class="fl">0.3</span> <span class="op">*</span> <span class="va">W</span> <span class="op">+</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="va">A1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="va">A2</span> <span class="op">&lt;-</span> <span class="fu">rexpit</span><span class="op">(</span><span class="va">W</span> <span class="op">+</span> <span class="va">A1</span> <span class="op">+</span> <span class="va">L</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu">rexpit</span><span class="op">(</span><span class="va">W</span> <span class="op">-</span> <span class="fl">0.6</span> <span class="op">*</span> <span class="va">A1</span> <span class="op">+</span> <span class="va">L</span> <span class="op">-</span> <span class="fl">0.8</span> <span class="op">*</span> <span class="va">A2</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">W</span>, <span class="va">A1</span>, <span class="va">L</span>, <span class="va">A2</span>, <span class="va">Y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;             W A1          L A2 Y</span></span>
<span><span class="co">#&gt; 1 -0.45873170  0  2.3830277  1 1</span></span>
<span><span class="co">#&gt; 2  1.39178381  0  1.2826659  1 1</span></span>
<span><span class="co">#&gt; 3 -1.56179608  0  0.1775910  1 0</span></span>
<span><span class="co">#&gt; 4  0.01141841  0 -1.3279717  0 0</span></span>
<span><span class="co">#&gt; 5  1.60053701  1 -1.3782538  1 0</span></span>
<span><span class="co">#&gt; 6  0.86174793  1 -0.2082456  0 0</span></span></code></pre></div>
<p>Treatment regime of interest: set A1 to 0, set A2 to 0</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ltmle</span><span class="op">(</span><span class="va">data</span>, Anodes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A1"</span>, <span class="st">"A2"</span><span class="op">)</span>, Lnodes<span class="op">=</span><span class="st">"L"</span>, Ynodes<span class="op">=</span><span class="st">"Y"</span>, abar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Qform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for L:</span></span>
<span><span class="co">#&gt; Q.kplus1 ~ W + A1</span></span>
<span><span class="co">#&gt; formula for Y:</span></span>
<span><span class="co">#&gt; Q.kplus1 ~ W + A1 + L + A2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; gform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for A1:</span></span>
<span><span class="co">#&gt; A1 ~ W</span></span>
<span><span class="co">#&gt; formula for A2:</span></span>
<span><span class="co">#&gt; A2 ~ W + A1 + L</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ltmle(data = data, Anodes = c("A1", "A2"), Lnodes = "L", Ynodes = "Y", </span></span>
<span><span class="co">#&gt;     abar = c(0, 0))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; TMLE Estimate:  0.4822286</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="longitudinal-data-with-censoring">Longitudinal data with censoring<a class="anchor" aria-label="anchor" href="#longitudinal-data-with-censoring"></a>
</h2>
<p>W -&gt; A1 -&gt; C -&gt; L -&gt; A2 -&gt; Y</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="va">A1</span> <span class="op">&lt;-</span> <span class="fu">rexpit</span><span class="op">(</span><span class="va">W</span><span class="op">)</span></span>
<span><span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BinaryToCensoring.html">BinaryToCensoring</a></span><span class="op">(</span>is.censored <span class="op">=</span> <span class="fu">rexpit</span><span class="op">(</span><span class="fl">0.6</span> <span class="op">*</span> <span class="va">W</span> <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="va">A1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">uncensored</span> <span class="op">&lt;-</span> <span class="va">C</span> <span class="op">==</span> <span class="st">"uncensored"</span></span>
<span><span class="va">L</span> <span class="op">&lt;-</span> <span class="va">A2</span> <span class="op">&lt;-</span> <span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">n</span><span class="op">)</span></span>
<span><span class="va">L</span><span class="op">[</span><span class="va">uncensored</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">0.3</span> <span class="op">*</span> <span class="va">W</span><span class="op">[</span><span class="va">uncensored</span><span class="op">]</span> <span class="op">+</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="va">A1</span><span class="op">[</span><span class="va">uncensored</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">uncensored</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">A2</span><span class="op">[</span><span class="va">uncensored</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">rexpit</span><span class="op">(</span><span class="va">W</span><span class="op">[</span><span class="va">uncensored</span><span class="op">]</span> <span class="op">+</span> <span class="va">A1</span><span class="op">[</span><span class="va">uncensored</span><span class="op">]</span> <span class="op">+</span> <span class="va">L</span><span class="op">[</span><span class="va">uncensored</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">Y</span><span class="op">[</span><span class="va">uncensored</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">rexpit</span><span class="op">(</span><span class="va">W</span><span class="op">[</span><span class="va">uncensored</span><span class="op">]</span> <span class="op">-</span> <span class="fl">0.6</span> <span class="op">*</span> <span class="va">A1</span><span class="op">[</span><span class="va">uncensored</span><span class="op">]</span> <span class="op">+</span> <span class="va">L</span><span class="op">[</span><span class="va">uncensored</span><span class="op">]</span> <span class="op">-</span> <span class="fl">0.8</span> <span class="op">*</span> <span class="va">A2</span><span class="op">[</span><span class="va">uncensored</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">W</span>, <span class="va">A1</span>, <span class="va">C</span>, <span class="va">L</span>, <span class="va">A2</span>, <span class="va">Y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;            W A1          C          L A2  Y</span></span>
<span><span class="co">#&gt; 1 -0.4360245  0 uncensored -0.8278242  0  0</span></span>
<span><span class="co">#&gt; 2  1.5851055  1 uncensored  2.0021827  1  1</span></span>
<span><span class="co">#&gt; 3 -0.5251617  0   censored         NA NA NA</span></span>
<span><span class="co">#&gt; 4 -0.1236538  0   censored         NA NA NA</span></span>
<span><span class="co">#&gt; 5  2.3310144  1   censored         NA NA NA</span></span>
<span><span class="co">#&gt; 6  0.2353337  0   censored         NA NA NA</span></span></code></pre></div>
<p>Treatment regime of interest: set A1 to 1, set A2 to 0, set C to
uncensored:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ltmle</span><span class="op">(</span><span class="va">data</span>, Anodes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A1"</span>, <span class="st">"A2"</span><span class="op">)</span>, Cnodes <span class="op">=</span> <span class="st">"C"</span>, Lnodes<span class="op">=</span><span class="st">"L"</span>, Ynodes<span class="op">=</span><span class="st">"Y"</span>, abar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Qform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for L:</span></span>
<span><span class="co">#&gt; Q.kplus1 ~ W + A1</span></span>
<span><span class="co">#&gt; formula for Y:</span></span>
<span><span class="co">#&gt; Q.kplus1 ~ W + A1 + L + A2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; gform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for A1:</span></span>
<span><span class="co">#&gt; A1 ~ W</span></span>
<span><span class="co">#&gt; formula for C:</span></span>
<span><span class="co">#&gt; C ~ W + A1</span></span>
<span><span class="co">#&gt; formula for A2:</span></span>
<span><span class="co">#&gt; A2 ~ W + A1 + L</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ltmle(data = data, Anodes = c("A1", "A2"), Cnodes = "C", Lnodes = "L", </span></span>
<span><span class="co">#&gt;     Ynodes = "Y", abar = c(1, 0))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; TMLE Estimate:  0.5321709</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="dynamic-treatment">Dynamic treatment<a class="anchor" aria-label="anchor" href="#dynamic-treatment"></a>
</h2>
<p>Treatment regime of interest is: Always treat at time 1 (A1 = 1),
treat at at time 2 (A2 = 1) if L &gt; 0</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">abar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow<span class="op">=</span><span class="va">n</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">abar</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">abar</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">L</span> <span class="op">&gt;</span> <span class="fl">0</span></span>
<span></span>
<span><span class="va">result.abar</span> <span class="op">&lt;-</span> <span class="fu">ltmle</span><span class="op">(</span><span class="va">data</span>, Anodes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A1"</span>, <span class="st">"A2"</span><span class="op">)</span>, Cnodes <span class="op">=</span> <span class="st">"C"</span>, Lnodes<span class="op">=</span><span class="st">"L"</span>, Ynodes<span class="op">=</span><span class="st">"Y"</span>, abar<span class="op">=</span><span class="va">abar</span><span class="op">)</span></span>
<span><span class="co">#&gt; Qform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for L:</span></span>
<span><span class="co">#&gt; Q.kplus1 ~ W + A1</span></span>
<span><span class="co">#&gt; formula for Y:</span></span>
<span><span class="co">#&gt; Q.kplus1 ~ W + A1 + L + A2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; gform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for A1:</span></span>
<span><span class="co">#&gt; A1 ~ W</span></span>
<span><span class="co">#&gt; formula for C:</span></span>
<span><span class="co">#&gt; C ~ W + A1</span></span>
<span><span class="co">#&gt; formula for A2:</span></span>
<span><span class="co">#&gt; A2 ~ W + A1 + L</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span></span>
<span><span class="va">result.abar</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ltmle(data = data, Anodes = c("A1", "A2"), Cnodes = "C", Lnodes = "L", </span></span>
<span><span class="co">#&gt;     Ynodes = "Y", abar = abar)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; TMLE Estimate:  0.3047568</span></span></code></pre></div>
<p>The regime can also be specified as a <code>rule</code> function.
<code>rule</code> is a function applied to each row of <code>data</code>
which returns a numeric vector of the same length as
<code>Anodes</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rule</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">row</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">row</span><span class="op">[</span><span class="st">"L"</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result.rule</span> <span class="op">&lt;-</span> <span class="fu">ltmle</span><span class="op">(</span><span class="va">data</span>, Anodes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A1"</span>, <span class="st">"A2"</span><span class="op">)</span>, Cnodes <span class="op">=</span> <span class="st">"C"</span>, Lnodes<span class="op">=</span><span class="st">"L"</span>, Ynodes<span class="op">=</span><span class="st">"Y"</span>, rule<span class="op">=</span><span class="va">rule</span><span class="op">)</span></span>
<span><span class="co">#&gt; Qform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for L:</span></span>
<span><span class="co">#&gt; Q.kplus1 ~ W + A1</span></span>
<span><span class="co">#&gt; formula for Y:</span></span>
<span><span class="co">#&gt; Q.kplus1 ~ W + A1 + L + A2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; gform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for A1:</span></span>
<span><span class="co">#&gt; A1 ~ W</span></span>
<span><span class="co">#&gt; formula for C:</span></span>
<span><span class="co">#&gt; C ~ W + A1</span></span>
<span><span class="co">#&gt; formula for A2:</span></span>
<span><span class="co">#&gt; A2 ~ W + A1 + L</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span></span>
<span><span class="va">result.rule</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ltmle(data = data, Anodes = c("A1", "A2"), Cnodes = "C", Lnodes = "L", </span></span>
<span><span class="co">#&gt;     Ynodes = "Y", rule = rule)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; TMLE Estimate:  0.3047568</span></span></code></pre></div>
<p>Specfifying the regime using <code>abar</code> and using
<code>rule</code> give the same result:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result.abar</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimator:  tmle </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ltmle(data = data, Anodes = c("A1", "A2"), Cnodes = "C", Lnodes = "L", </span></span>
<span><span class="co">#&gt;     Ynodes = "Y", abar = abar)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    Parameter Estimate:  0.30476 </span></span>
<span><span class="co">#&gt;     Estimated Std Err:  0.032637 </span></span>
<span><span class="co">#&gt;               p-value:  &lt;2e-16 </span></span>
<span><span class="co">#&gt;     95% Conf Interval: (0.24079, 0.36872)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result.rule</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimator:  tmle </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ltmle(data = data, Anodes = c("A1", "A2"), Cnodes = "C", Lnodes = "L", </span></span>
<span><span class="co">#&gt;     Ynodes = "Y", rule = rule)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    Parameter Estimate:  0.30476 </span></span>
<span><span class="co">#&gt;     Estimated Std Err:  0.032637 </span></span>
<span><span class="co">#&gt;               p-value:  &lt;2e-16 </span></span>
<span><span class="co">#&gt;     95% Conf Interval: (0.24079, 0.36872)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="variance-estimation">Variance estimation<a class="anchor" aria-label="anchor" href="#variance-estimation"></a>
</h2>
<p>Consider a simple point treatment problem with observed data <span class="math inline">\(W, A, Y\)</span>. But there is a positivity
problem - for small values of <span class="math inline">\(W\)</span>,
<span class="math inline">\(Prob(A = 1)\)</span> is very small.</p>
<p>The true parameter value, <span class="math inline">\(E[Y_1]\)</span>
is approximately 0.697.</p>
<p>The true TMLE standard deviation (the standard deviation of the TMLE
estimate if we ran it many times on many sets of data) is approximately
0.056.</p>
<p>The true IPTW standard deviation (the standard deviation of the IPTW
estimate if we ran it many times on many sets of data) is approximately
0.059.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu">rexpit</span><span class="op">(</span><span class="fl">4</span> <span class="op">*</span> <span class="va">W</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu">rexpit</span><span class="op">(</span><span class="va">W</span> <span class="op">+</span> <span class="va">A</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">W</span>, <span class="va">A</span>, <span class="va">Y</span><span class="op">)</span></span></code></pre></div>
<p>The default <code>variance.method</code> is <code>"tmle"</code> - use
TMLE in order to approximate the variance of the TMLE estimator. The
estimated standard deviation is close to the true TMLE standard
deviation.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r1</span> <span class="op">&lt;-</span> <span class="fu">ltmle</span><span class="op">(</span><span class="va">df</span>, Anodes<span class="op">=</span><span class="st">"A"</span>, Ynodes<span class="op">=</span><span class="st">"Y"</span>, abar <span class="op">=</span> <span class="fl">1</span>, estimate.time<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Qform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for Y:</span></span>
<span><span class="co">#&gt; Q.kplus1 ~ W + A</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; gform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for A:</span></span>
<span><span class="co">#&gt; A ~ W</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">r1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimator:  tmle </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ltmle(data = df, Anodes = "A", Ynodes = "Y", abar = 1, estimate.time = FALSE)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    Parameter Estimate:  0.66969 </span></span>
<span><span class="co">#&gt;     Estimated Std Err:  0.060703 </span></span>
<span><span class="co">#&gt;               p-value:  &lt;2e-16 </span></span>
<span><span class="co">#&gt;     95% Conf Interval: (0.55071, 0.78866)</span></span></code></pre></div>
<p>If <code>variance.method</code> is <code>"ic"</code>, variance is
estimated using the estimated Influence Curve. This is fast to compute,
but may be significantly anticonservative in data with positivity
violations.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r2</span> <span class="op">&lt;-</span> <span class="fu">ltmle</span><span class="op">(</span><span class="va">df</span>, Anodes<span class="op">=</span><span class="st">"A"</span>, Ynodes<span class="op">=</span><span class="st">"Y"</span>, abar <span class="op">=</span> <span class="fl">1</span>, estimate.time<span class="op">=</span><span class="cn">FALSE</span>, </span>
<span> variance.method<span class="op">=</span><span class="st">"ic"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Qform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for Y:</span></span>
<span><span class="co">#&gt; Q.kplus1 ~ W + A</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; gform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for A:</span></span>
<span><span class="co">#&gt; A ~ W</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Warning in CheckForVarianceWarning(inputs, g.ratio): Variance estimate is based</span></span>
<span><span class="co">#&gt; on influence curve only, which may be significantly anticonservative because</span></span>
<span><span class="co">#&gt; your data appears to contain positivity violations. It is recommended to use</span></span>
<span><span class="co">#&gt; variance.method='tmle' or variance.method='iptw' to obtain a more robust</span></span>
<span><span class="co">#&gt; variance estimate (but run time may be significantly longer). See</span></span>
<span><span class="co">#&gt; variance.method details in ?ltmle</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">r2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimator:  tmle </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ltmle(data = df, Anodes = "A", Ynodes = "Y", abar = 1, estimate.time = FALSE, </span></span>
<span><span class="co">#&gt;     variance.method = "ic")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    Parameter Estimate:  0.66969 </span></span>
<span><span class="co">#&gt;     Estimated Std Err:  0.04401 </span></span>
<span><span class="co">#&gt;               p-value:  &lt;2e-16 </span></span>
<span><span class="co">#&gt;     95% Conf Interval: (0.58343, 0.75595)</span></span></code></pre></div>
<p>If <code>variance.method</code> is <code>"iptw"</code>, then use
<em>IPTW</em> in order to approximate the variance of the <em>TMLE</em>
estimator. This is faster to compute than
<code>variance.method = "tmle"</code> but less accurate (and slower to
compute than <code>variance.method = "ic"</code> but more accurate).</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r3</span> <span class="op">&lt;-</span> <span class="fu">ltmle</span><span class="op">(</span><span class="va">df</span>, Anodes<span class="op">=</span><span class="st">"A"</span>, Ynodes<span class="op">=</span><span class="st">"Y"</span>, abar <span class="op">=</span> <span class="fl">1</span>, estimate.time<span class="op">=</span><span class="cn">FALSE</span>, </span>
<span> variance.method<span class="op">=</span><span class="st">"iptw"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Qform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for Y:</span></span>
<span><span class="co">#&gt; Q.kplus1 ~ W + A</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; gform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for A:</span></span>
<span><span class="co">#&gt; A ~ W</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">r3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimator:  tmle </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ltmle(data = df, Anodes = "A", Ynodes = "Y", abar = 1, estimate.time = FALSE, </span></span>
<span><span class="co">#&gt;     variance.method = "iptw")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    Parameter Estimate:  0.66969 </span></span>
<span><span class="co">#&gt;     Estimated Std Err:  0.053186 </span></span>
<span><span class="co">#&gt;               p-value:  &lt;2e-16 </span></span>
<span><span class="co">#&gt;     95% Conf Interval: (0.56545, 0.77393)</span></span></code></pre></div>
<p>If we use the IPTW estimator, <code>variance.method</code> does not
change the estimated standard deviation (it only affects the estimated
standard deviation of the TMLE estimator).</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">r1</span>, estimator<span class="op">=</span><span class="st">"iptw"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimator:  iptw </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ltmle(data = df, Anodes = "A", Ynodes = "Y", abar = 1, estimate.time = FALSE)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    Parameter Estimate:  0.72006 </span></span>
<span><span class="co">#&gt;     Estimated Std Err:  0.052111 </span></span>
<span><span class="co">#&gt;               p-value:  &lt;2e-16 </span></span>
<span><span class="co">#&gt;     95% Conf Interval: (0.61793, 0.8222)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">r2</span>, estimator<span class="op">=</span><span class="st">"iptw"</span><span class="op">)</span><span class="op">)</span> <span class="co">#the same - variance.method only affects TMLE</span></span>
<span><span class="co">#&gt; Estimator:  iptw </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ltmle(data = df, Anodes = "A", Ynodes = "Y", abar = 1, estimate.time = FALSE, </span></span>
<span><span class="co">#&gt;     variance.method = "ic")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    Parameter Estimate:  0.72006 </span></span>
<span><span class="co">#&gt;     Estimated Std Err:  0.052111 </span></span>
<span><span class="co">#&gt;               p-value:  &lt;2e-16 </span></span>
<span><span class="co">#&gt;     95% Conf Interval: (0.61793, 0.8222)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">r3</span>, estimator<span class="op">=</span><span class="st">"iptw"</span><span class="op">)</span><span class="op">)</span> <span class="co">#the same - variance.method only affects TMLE</span></span>
<span><span class="co">#&gt; Estimator:  iptw </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ltmle(data = df, Anodes = "A", Ynodes = "Y", abar = 1, estimate.time = FALSE, </span></span>
<span><span class="co">#&gt;     variance.method = "iptw")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    Parameter Estimate:  0.72006 </span></span>
<span><span class="co">#&gt;     Estimated Std Err:  0.052111 </span></span>
<span><span class="co">#&gt;               p-value:  &lt;2e-16 </span></span>
<span><span class="co">#&gt;     95% Conf Interval: (0.61793, 0.8222)</span></span></code></pre></div>
<p>We can see that the values of g are very small.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">r1</span><span class="op">$</span><span class="va">cum.g</span><span class="op">)</span></span>
<span><span class="co">#&gt;        V1         </span></span>
<span><span class="co">#&gt;  Min.   :0.01000  </span></span>
<span><span class="co">#&gt;  1st Qu.:0.04636  </span></span>
<span><span class="co">#&gt;  Median :0.43801  </span></span>
<span><span class="co">#&gt;  Mean   :0.48204  </span></span>
<span><span class="co">#&gt;  3rd Qu.:0.92743  </span></span>
<span><span class="co">#&gt;  Max.   :1.00000</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">r1</span><span class="op">$</span><span class="va">cum.g.unbounded</span><span class="op">)</span></span>
<span><span class="co">#&gt;        V1           </span></span>
<span><span class="co">#&gt;  Min.   :0.0000034  </span></span>
<span><span class="co">#&gt;  1st Qu.:0.0463619  </span></span>
<span><span class="co">#&gt;  Median :0.4380090  </span></span>
<span><span class="co">#&gt;  Mean   :0.4810000  </span></span>
<span><span class="co">#&gt;  3rd Qu.:0.9274284  </span></span>
<span><span class="co">#&gt;  Max.   :0.9999998</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">df</span>, g <span class="op">=</span> <span class="va">r1</span><span class="op">$</span><span class="va">cum.g</span>, g.unbounded <span class="op">=</span> <span class="va">r1</span><span class="op">$</span><span class="va">cum.g.unbounded</span><span class="op">)</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="co">#&gt;               W A Y          g  g.unbounded</span></span>
<span><span class="co">#&gt; 1  -2.547528148 0 0 0.01000000 0.0000206524</span></span>
<span><span class="co">#&gt; 2   0.395693963 0 1 0.83572583 0.8357258294</span></span>
<span><span class="co">#&gt; 3   0.298522443 1 1 0.77151706 0.7715170640</span></span>
<span><span class="co">#&gt; 4   1.454576165 1 1 0.99774669 0.9977466850</span></span>
<span><span class="co">#&gt; 5  -0.238234778 0 0 0.25977689 0.2597768895</span></span>
<span><span class="co">#&gt; 6   1.079518202 1 1 0.98913317 0.9891331684</span></span>
<span><span class="co">#&gt; 7  -0.394463416 0 1 0.15367075 0.1536707455</span></span>
<span><span class="co">#&gt; 8  -0.243298336 1 1 0.25569103 0.2556910295</span></span>
<span><span class="co">#&gt; 9  -1.017860034 0 0 0.01292523 0.0129252336</span></span>
<span><span class="co">#&gt; 10 -0.910709808 0 0 0.02016160 0.0201615996</span></span>
<span><span class="co">#&gt; 11 -1.596117871 0 1 0.01000000 0.0011410800</span></span>
<span><span class="co">#&gt; 12 -1.764476874 0 0 0.01000000 0.0005612562</span></span>
<span><span class="co">#&gt; 13 -0.101793931 0 0 0.38423167 0.3842316710</span></span>
<span><span class="co">#&gt; 14  0.444689487 1 1 0.86216929 0.8621692886</span></span>
<span><span class="co">#&gt; 15  0.009522572 1 0 0.49947613 0.4994761318</span></span>
<span><span class="co">#&gt; 16 -0.394283503 0 0 0.15376947 0.1537694669</span></span>
<span><span class="co">#&gt; 17  0.295258520 1 1 0.76908115 0.7690811481</span></span>
<span><span class="co">#&gt; 18 -0.539534761 0 1 0.08964292 0.0896429169</span></span>
<span><span class="co">#&gt; 19 -1.453828629 0 0 0.01000000 0.0020775906</span></span>
<span><span class="co">#&gt; 20  0.796213361 1 1 0.96497846 0.9649784618</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="hierarchical-data-and-the-id-variable">Hierarchical data and the id variable<a class="anchor" aria-label="anchor" href="#hierarchical-data-and-the-id-variable"></a>
</h2>
<p>The <code>id</code> argument can be used to specify hierarchical
data, such as people in a household.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">num.households</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">people.in.household</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">num.households</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">people.in.household</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 500</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">people.in.household</span><span class="op">)</span> </span>
<span><span class="va">n</span></span>
<span><span class="co">#&gt; [1] 2779</span></span>
<span><span class="va">W.household</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">num.households</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">W.household</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 500</span></span>
<span><span class="va">W.household.expanded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">W.household</span>, times <span class="op">=</span> <span class="va">people.in.household</span><span class="op">)</span></span>
<span><span class="va">W.indiv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">W.indiv</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2779</span></span>
<span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu">rexpit</span><span class="op">(</span><span class="fl">1.5</span> <span class="op">*</span> <span class="va">W.household.expanded</span> <span class="op">+</span> <span class="fl">0.4</span> <span class="op">*</span> <span class="va">W.indiv</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu">rexpit</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">2.3</span> <span class="op">*</span> <span class="va">W.household.expanded</span> <span class="op">-</span> <span class="fl">0.6</span> <span class="op">*</span> <span class="va">W.indiv</span> <span class="op">+</span> <span class="fl">1.2</span> <span class="op">*</span> <span class="va">A</span><span class="op">)</span></span></code></pre></div>
<p>id can be an integer, factor, or character (or any type that can be
coerced to factor),</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="va">num.households</span> </span>
<span><span class="va">id.expanded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">id</span>, times <span class="op">=</span> <span class="va">people.in.household</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">W.household.expanded</span>, <span class="va">W.indiv</span>, <span class="va">A</span>, <span class="va">Y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">id.expanded</span>, <span class="va">data</span><span class="op">)</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="co">#&gt;    id.expanded W.household.expanded     W.indiv A Y</span></span>
<span><span class="co">#&gt; 1            1            0.7338290  0.19167419 1 1</span></span>
<span><span class="co">#&gt; 2            1            0.7338290 -0.27671546 1 1</span></span>
<span><span class="co">#&gt; 3            2            0.2383485  0.42544393 0 0</span></span>
<span><span class="co">#&gt; 4            2            0.2383485  0.20770280 0 0</span></span>
<span><span class="co">#&gt; 5            2            0.2383485 -0.70788107 1 1</span></span>
<span><span class="co">#&gt; 6            2            0.2383485  0.16072397 1 1</span></span>
<span><span class="co">#&gt; 7            2            0.2383485  0.76005943 1 0</span></span>
<span><span class="co">#&gt; 8            2            0.2383485  0.06808388 1 1</span></span>
<span><span class="co">#&gt; 9            2            0.2383485  0.96140078 0 0</span></span>
<span><span class="co">#&gt; 10           2            0.2383485  0.20371661 0 0</span></span>
<span><span class="co">#&gt; 11           2            0.2383485 -0.66029422 1 1</span></span>
<span><span class="co">#&gt; 12           2            0.2383485  0.86632469 0 0</span></span>
<span><span class="co">#&gt; 13           3           -1.3096128 -0.27916221 0 0</span></span>
<span><span class="co">#&gt; 14           3           -1.3096128 -0.61063012 1 0</span></span>
<span><span class="co">#&gt; 15           3           -1.3096128  1.22858659 0 0</span></span>
<span><span class="co">#&gt; 16           4           -0.4621275  1.29635135 0 0</span></span>
<span><span class="co">#&gt; 17           4           -0.4621275 -0.23697455 0 0</span></span>
<span><span class="co">#&gt; 18           5            1.0955654 -0.68682486 1 1</span></span>
<span><span class="co">#&gt; 19           5            1.0955654 -0.56653722 0 1</span></span>
<span><span class="co">#&gt; 20           5            1.0955654  0.38059233 0 1</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result.without.id</span> <span class="op">&lt;-</span> <span class="fu">ltmle</span><span class="op">(</span><span class="va">data</span>, Anodes <span class="op">=</span> <span class="st">"A"</span>, Ynodes <span class="op">=</span> <span class="st">"Y"</span>, abar <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; Qform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for Y:</span></span>
<span><span class="co">#&gt; Q.kplus1 ~ W.household.expanded + W.indiv + A</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; gform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for A:</span></span>
<span><span class="co">#&gt; A ~ W.household.expanded + W.indiv</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span></span>
<span><span class="va">result.with.id</span> <span class="op">&lt;-</span> <span class="fu">ltmle</span><span class="op">(</span><span class="va">data</span>, Anodes <span class="op">=</span> <span class="st">"A"</span>, Ynodes <span class="op">=</span> <span class="st">"Y"</span>, abar <span class="op">=</span> <span class="fl">0</span>, id <span class="op">=</span> <span class="va">id.expanded</span><span class="op">)</span></span>
<span><span class="co">#&gt; Qform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for Y:</span></span>
<span><span class="co">#&gt; Q.kplus1 ~ W.household.expanded + W.indiv + A</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; gform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for A:</span></span>
<span><span class="co">#&gt; A ~ W.household.expanded + W.indiv</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span></span></code></pre></div>
<p>Omitting the id argument makes the individuals seem more independent
than they are, which gives artificially low variance estimates.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result.without.id</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimator:  tmle </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ltmle(data = data, Anodes = "A", Ynodes = "Y", abar = 0)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    Parameter Estimate:  0.35783 </span></span>
<span><span class="co">#&gt;     Estimated Std Err:  0.013589 </span></span>
<span><span class="co">#&gt;               p-value:  &lt;2e-16 </span></span>
<span><span class="co">#&gt;     95% Conf Interval: (0.33119, 0.38446)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result.with.id</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimator:  tmle </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ltmle(data = data, Anodes = "A", Ynodes = "Y", abar = 0, id = id.expanded)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    Parameter Estimate:  0.35783 </span></span>
<span><span class="co">#&gt;     Estimated Std Err:  0.021422 </span></span>
<span><span class="co">#&gt;               p-value:  &lt;2e-16 </span></span>
<span><span class="co">#&gt;     95% Conf Interval: (0.31584, 0.39981)</span></span></code></pre></div>
<p>The influence curve is a vector with length equal to the number of
independent units.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">result.without.id</span><span class="op">$</span><span class="va">IC</span><span class="op">$</span><span class="va">tmle</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2779</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">result.with.id</span><span class="op">$</span><span class="va">IC</span><span class="op">$</span><span class="va">tmle</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 500</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="multiple-time-dependent-covariates-and-treatments-at-each-time-point-continuous-y-values">Multiple time-dependent covariates and treatments at each time
point, continuous Y values<a class="anchor" aria-label="anchor" href="#multiple-time-dependent-covariates-and-treatments-at-each-time-point-continuous-y-values"></a>
</h2>
<p>age -&gt; gender -&gt; A1 -&gt; L1a -&gt; L1b -&gt; Y1 -&gt; A2 -&gt;
L2a -&gt; L2b -&gt; Y2</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">gender</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">A1</span> <span class="op">&lt;-</span> <span class="fu">rexpit</span><span class="op">(</span><span class="va">age</span> <span class="op">+</span> <span class="va">gender</span><span class="op">)</span></span>
<span><span class="va">L1a</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">age</span> <span class="op">-</span> <span class="fl">3</span><span class="op">*</span><span class="va">gender</span> <span class="op">+</span> <span class="fl">2</span><span class="op">*</span><span class="va">A1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="va">L1b</span> <span class="op">&lt;-</span> <span class="fu">rexpit</span><span class="op">(</span><span class="va">age</span> <span class="op">+</span> <span class="fl">1.5</span><span class="op">*</span><span class="va">gender</span> <span class="op">-</span> <span class="va">A1</span><span class="op">)</span></span>
<span><span class="va">Y1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">age</span> <span class="op">-</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">L1a</span> <span class="op">+</span> <span class="fl">0.7</span><span class="op">*</span><span class="va">L1b</span> <span class="op">+</span> <span class="va">A1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">A2</span> <span class="op">&lt;-</span> <span class="fu">rexpit</span><span class="op">(</span><span class="va">age</span> <span class="op">+</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">A1</span> <span class="op">-</span> <span class="va">L1a</span> <span class="op">-</span> <span class="va">L1b</span><span class="op">)</span></span>
<span><span class="va">L2a</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">age</span> <span class="op">-</span> <span class="fl">3</span><span class="op">*</span><span class="va">gender</span> <span class="op">+</span> <span class="fl">2</span><span class="op">*</span><span class="va">A1</span> <span class="op">+</span> <span class="va">A2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="va">L2b</span> <span class="op">&lt;-</span> <span class="fu">rexpit</span><span class="op">(</span><span class="va">age</span> <span class="op">+</span> <span class="fl">1.5</span><span class="op">*</span><span class="va">gender</span> <span class="op">-</span> <span class="va">A1</span> <span class="op">-</span> <span class="va">A2</span><span class="op">)</span></span>
<span><span class="va">Y2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">age</span> <span class="op">-</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">L1a</span> <span class="op">+</span> <span class="va">L1b</span> <span class="op">+</span> <span class="va">A1</span> <span class="op">+</span> <span class="fl">1.8</span><span class="op">*</span><span class="va">A2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">gender</span>, <span class="va">A1</span>, <span class="va">L1a</span>, <span class="va">L1b</span>, <span class="va">Y1</span>, <span class="va">A2</span>, <span class="va">L2a</span>, <span class="va">L2b</span>, <span class="va">Y2</span><span class="op">)</span></span></code></pre></div>
<p>Also show some different ways of specifying the nodes (either names
or indexes works):</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">ltmle</span><span class="op">(</span><span class="va">data</span>, Anodes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">7</span><span class="op">)</span>, Lnodes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"L1a"</span>, <span class="st">"L1b"</span>, <span class="st">"L2a"</span>, <span class="st">"L2b"</span><span class="op">)</span>, </span>
<span> Ynodes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"^Y"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>, abar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Qform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for L1a:</span></span>
<span><span class="co">#&gt; Q.kplus1 ~ age + gender + A1</span></span>
<span><span class="co">#&gt; formula for L2a:</span></span>
<span><span class="co">#&gt; Q.kplus1 ~ age + gender + A1 + L1a + L1b + Y1 + A2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; gform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for A1:</span></span>
<span><span class="co">#&gt; A1 ~ age + gender</span></span>
<span><span class="co">#&gt; formula for A2:</span></span>
<span><span class="co">#&gt; A2 ~ age + gender + A1 + L1a + L1b + Y1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span></span>
<span><span class="co">#&gt; Warning in CheckForVarianceWarning(inputs, g.ratio): Variance estimate is based</span></span>
<span><span class="co">#&gt; on influence curve only, which may be significantly anticonservative because</span></span>
<span><span class="co">#&gt; your data appears to contain positivity violations. Robust variance estimate is</span></span>
<span><span class="co">#&gt; not currently available with non binary outcomes but this will be addressed in</span></span>
<span><span class="co">#&gt; a future release.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimator:  tmle </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ltmle(data = data, Anodes = c(3, 7), Lnodes = c("L1a", "L1b", </span></span>
<span><span class="co">#&gt;     "L2a", "L2b"), Ynodes = grep("^Y", names(data)), abar = c(1, </span></span>
<span><span class="co">#&gt;     0))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    Parameter Estimate:  0.80031 </span></span>
<span><span class="co">#&gt;     Estimated Std Err:  0.018014 </span></span>
<span><span class="co">#&gt;               p-value:  &lt;2e-16 </span></span>
<span><span class="co">#&gt;     95% Conf Interval: (0.765, 0.83561)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="specifying-qform">Specifying Qform<a class="anchor" aria-label="anchor" href="#specifying-qform"></a>
</h2>
<p>Usually you would specify a <code>Qform</code> for all of the Lnodes
and Ynodes but in this case L1a, L1b, Y1 is a “block” of L/Y nodes not
separated by Anodes or Cnodes (the same is true for L2a, L2b, Y2). Only
one regression is required at the first L/Y node in a block. You can
pass regression formulas for the other L/Y nodes, but they will be
ignored.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">ltmle</span><span class="op">(</span><span class="va">data</span>, Anodes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">7</span><span class="op">)</span>, Lnodes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"L1a"</span>, <span class="st">"L1b"</span>, <span class="st">"L2a"</span>, <span class="st">"L2b"</span><span class="op">)</span>, </span>
<span> Ynodes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"^Y"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>, abar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span> Qform<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>L1a<span class="op">=</span><span class="st">"Q.kplus1 ~ 1"</span>, L2a<span class="op">=</span><span class="st">"Q.kplus1 ~ 1"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; gform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for A1:</span></span>
<span><span class="co">#&gt; A1 ~ age + gender</span></span>
<span><span class="co">#&gt; formula for A2:</span></span>
<span><span class="co">#&gt; A2 ~ age + gender + A1 + L1a + L1b + Y1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span></span>
<span><span class="co">#&gt; Warning in CheckForVarianceWarning(inputs, g.ratio): Variance estimate is based</span></span>
<span><span class="co">#&gt; on influence curve only, which may be significantly anticonservative because</span></span>
<span><span class="co">#&gt; your data appears to contain positivity violations. Robust variance estimate is</span></span>
<span><span class="co">#&gt; not currently available with non binary outcomes but this will be addressed in</span></span>
<span><span class="co">#&gt; a future release.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimator:  tmle </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ltmle(data = data, Anodes = c(3, 7), Lnodes = c("L1a", "L1b", </span></span>
<span><span class="co">#&gt;     "L2a", "L2b"), Ynodes = grep("^Y", names(data)), Qform = c(L1a = "Q.kplus1 ~ 1", </span></span>
<span><span class="co">#&gt;     L2a = "Q.kplus1 ~ 1"), abar = c(1, 0))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    Parameter Estimate:  0.82764 </span></span>
<span><span class="co">#&gt;     Estimated Std Err:  0.03305 </span></span>
<span><span class="co">#&gt;               p-value:  &lt;2e-16 </span></span>
<span><span class="co">#&gt;     95% Conf Interval: (0.76286, 0.89242)</span></span></code></pre></div>
<p>Gives the same result but prints a message saying some regression
formulas will be dropped:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">ltmle</span><span class="op">(</span><span class="va">data</span>, Anodes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">7</span><span class="op">)</span>, Lnodes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"L1a"</span>, <span class="st">"L1b"</span>, <span class="st">"L2a"</span>, <span class="st">"L2b"</span><span class="op">)</span>, </span>
<span> Ynodes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"^Y"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>, abar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span> Qform<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>L1a<span class="op">=</span><span class="st">"Q.kplus1 ~ 1"</span>, L1b<span class="op">=</span><span class="st">"Q.klus1~A1"</span>, </span>
<span> Y1<span class="op">=</span><span class="st">"Q.kplus1~L1a"</span>, L2a<span class="op">=</span><span class="st">"Q.kplus1 ~ 1"</span>, L2b<span class="op">=</span><span class="st">"Q.klus1~A1"</span>, Y2<span class="op">=</span><span class="st">"Q.kplus1~A2 + gender"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; L/Y nodes (after removing blocks)  : L1a L2a</span></span>
<span><span class="co">#&gt; Qform names                        : L1a L1b Y1 L2a L2b Y2</span></span>
<span><span class="co">#&gt; The following nodes are not being considered as L/Y nodes because they are part of a block</span></span>
<span><span class="co">#&gt; of L/Y nodes. They are being dropped from Qform:</span></span>
<span><span class="co">#&gt; L1b </span></span>
<span><span class="co">#&gt;  Y1 </span></span>
<span><span class="co">#&gt;  L2b </span></span>
<span><span class="co">#&gt;  Y2</span></span>
<span><span class="co">#&gt; gform not specified, using defaults:</span></span>
<span><span class="co">#&gt; formula for A1:</span></span>
<span><span class="co">#&gt; A1 ~ age + gender</span></span>
<span><span class="co">#&gt; formula for A2:</span></span>
<span><span class="co">#&gt; A2 ~ age + gender + A1 + L1a + L1b + Y1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span></span>
<span><span class="co">#&gt; Warning in CheckForVarianceWarning(inputs, g.ratio): Variance estimate is based</span></span>
<span><span class="co">#&gt; on influence curve only, which may be significantly anticonservative because</span></span>
<span><span class="co">#&gt; your data appears to contain positivity violations. Robust variance estimate is</span></span>
<span><span class="co">#&gt; not currently available with non binary outcomes but this will be addressed in</span></span>
<span><span class="co">#&gt; a future release.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimator:  tmle </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ltmle(data = data, Anodes = c(3, 7), Lnodes = c("L1a", "L1b", </span></span>
<span><span class="co">#&gt;     "L2a", "L2b"), Ynodes = grep("^Y", names(data)), Qform = c(L1a = "Q.kplus1 ~ 1", </span></span>
<span><span class="co">#&gt;     L1b = "Q.klus1~A1", Y1 = "Q.kplus1~L1a", L2a = "Q.kplus1 ~ 1", </span></span>
<span><span class="co">#&gt;     L2b = "Q.klus1~A1", Y2 = "Q.kplus1~A2 + gender"), abar = c(1, </span></span>
<span><span class="co">#&gt;     0))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    Parameter Estimate:  0.82764 </span></span>
<span><span class="co">#&gt;     Estimated Std Err:  0.03305 </span></span>
<span><span class="co">#&gt;               p-value:  &lt;2e-16 </span></span>
<span><span class="co">#&gt;     95% Conf Interval: (0.76286, 0.89242)</span></span></code></pre></div>
<p>If there were a Anode or Cnode between L1b and Y1, Y1 would also need
a Q regression formula.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Joshua Schwab, Samuel Lendle, Maya Petersen, Mark van der Laan.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
