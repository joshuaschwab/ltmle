<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Joshua Schwab" />

<meta name="date" content="2018-10-19" />

<title>Introduction to ltmle()</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Introduction to ltmle()</h1>
<h4 class="author"><em>Joshua Schwab</em></h4>
<h4 class="date"><em>2018-10-19</em></h4>



<div id="minimal-example" class="section level2">
<h2>Minimal Example</h2>
<p>Consider the observed data with time ordering W -&gt; A -&gt; Y.</p>
<p>W ~ N(0, 1)</p>
<p>A ~ binomial with P(A = 1) = expit(W)</p>
<p>Y ~ binomial with P(Y = 1) = expit(W + A)</p>
<p>where <span class="math inline">\(expit(z) = \frac{1}{1 + e^{-z}}\)</span></p>
<p>We want to know <span class="math inline">\(E[Y_1]\)</span> the expected value of Y, intervening to set A to 1.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1234</span>)
rexpit &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">rbinom</span>(<span class="dt">n=</span><span class="kw">length</span>(x), <span class="dt">size=</span><span class="dv">1</span>, <span class="dt">prob=</span><span class="kw">plogis</span>(x))
n &lt;-<span class="st"> </span><span class="dv">10000</span>
W &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n)
A &lt;-<span class="st"> </span><span class="kw">rexpit</span>(W)
Y &lt;-<span class="st"> </span><span class="kw">rexpit</span>(W <span class="op">+</span><span class="st"> </span>A)
data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(W, A, Y)</code></pre></div>
<p>We could try to use the simple mean of Y or the mean of Y when A = 1, but these will be biased.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(Y)
<span class="co">#&gt; [1] 0.5992</span>
<span class="kw">mean</span>(Y[A <span class="op">==</span><span class="st"> </span><span class="dv">1</span>])
<span class="co">#&gt; [1] 0.770479</span></code></pre></div>
<p>Now we use ltmle().</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">result &lt;-<span class="st"> </span><span class="kw">ltmle</span>(data, <span class="dt">Anodes =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">Ynodes =</span> <span class="st">&quot;Y&quot;</span>, <span class="dt">abar =</span> <span class="dv">1</span>)
<span class="co">#&gt; Qform not specified, using defaults:</span>
<span class="co">#&gt; formula for Y:</span>
<span class="co">#&gt; Q.kplus1 ~ W + A</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; gform not specified, using defaults:</span>
<span class="co">#&gt; formula for A:</span>
<span class="co">#&gt; A ~ W</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimate of time to completion: 2 to 6 minutes</span>
result
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; ltmle(data = data, Anodes = &quot;A&quot;, Ynodes = &quot;Y&quot;, abar = 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; TMLE Estimate:  0.700652</span></code></pre></div>
<p>Because we’re using simulated data, we can calculate the true value of <span class="math inline">\(E[Y_1]\)</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n.large &lt;-<span class="st"> </span><span class="fl">1e6</span>
W &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n.large)
A &lt;-<span class="st"> </span><span class="dv">1</span>
Y &lt;-<span class="st"> </span><span class="kw">rexpit</span>(W <span class="op">+</span><span class="st"> </span>A)
<span class="kw">mean</span>(Y)
<span class="co">#&gt; [1] 0.696346</span></code></pre></div>
</div>
<div id="single-time-point" class="section level2">
<h2>Single time point</h2>
<p>Time ordering of data is W1 -&gt; W2 -&gt; W3 -&gt; A -&gt; Y</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n &lt;-<span class="st"> </span><span class="dv">1000</span>
W1 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n)
W2 &lt;-<span class="st"> </span><span class="kw">rbinom</span>(n, <span class="dt">size=</span><span class="dv">1</span>, <span class="dt">prob=</span><span class="fl">0.3</span>)   
W3 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n)
A &lt;-<span class="st"> </span><span class="kw">rexpit</span>(<span class="op">-</span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>W1 <span class="op">+</span><span class="st"> </span>W3)
Y &lt;-<span class="st"> </span><span class="kw">rexpit</span>(<span class="op">-</span><span class="fl">0.5</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>W1<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.5</span> <span class="op">*</span><span class="st"> </span>W2 <span class="op">-</span><span class="st"> </span><span class="fl">0.5</span> <span class="op">*</span><span class="st"> </span>A <span class="op">+</span><span class="st"> </span><span class="fl">0.2</span> <span class="op">*</span><span class="st"> </span>W3 <span class="op">*</span><span class="st"> </span>A <span class="op">-</span><span class="st"> </span><span class="fl">1.1</span> <span class="op">*</span><span class="st"> </span>W3)
data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(W1, W2, W3, A, Y)</code></pre></div>
<p>True value of <span class="math inline">\(E[Y_1]\)</span> is approximately 0.5939.</p>
<p>SuperLearner semiparametric estimation using all parents as regressors</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">result &lt;-<span class="st"> </span><span class="kw">ltmle</span>(data, <span class="dt">Anodes=</span><span class="st">&quot;A&quot;</span>, <span class="dt">Lnodes=</span><span class="ot">NULL</span>, <span class="dt">Ynodes=</span><span class="st">&quot;Y&quot;</span>, <span class="dt">abar=</span><span class="dv">1</span>, <span class="dt">SL.library=</span><span class="st">&quot;default&quot;</span>)
<span class="co">#&gt; Loading required namespace: SuperLearner</span>
<span class="co">#&gt; Qform not specified, using defaults:</span>
<span class="co">#&gt; formula for Y:</span>
<span class="co">#&gt; Q.kplus1 ~ W1 + W2 + W3 + A</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; gform not specified, using defaults:</span>
<span class="co">#&gt; formula for A:</span>
<span class="co">#&gt; A ~ W1 + W2 + W3</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Loading required package: nnls</span>
<span class="co">#&gt; Loading required package: arm</span>
<span class="co">#&gt; Loading required package: MASS</span>
<span class="co">#&gt; Loading required package: Matrix</span>
<span class="co">#&gt; Loading required package: lme4</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; arm (Version 1.10-1, built: 2018-4-12)</span>
<span class="co">#&gt; Working directory is /Users/joshua/Dropbox (UC Berkeley Biostat)/Josh-Berkeley/ltmle-dev/vignettes</span>
<span class="co">#&gt; Estimate of time to completion: 1 to 2 minutes</span></code></pre></div>
<p>TMLE estimate:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(result)
<span class="co">#&gt; Estimator:  tmle </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; ltmle(data = data, Anodes = &quot;A&quot;, Lnodes = NULL, Ynodes = &quot;Y&quot;, </span>
<span class="co">#&gt;     abar = 1, SL.library = &quot;default&quot;)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    Parameter Estimate:  0.57053 </span>
<span class="co">#&gt;     Estimated Std Err:  0.045927 </span>
<span class="co">#&gt;               p-value:  &lt;2e-16 </span>
<span class="co">#&gt;     95% Conf Interval: (0.48052, 0.66055)</span></code></pre></div>
<p>IPTW estimate:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(result, <span class="dt">estimator=</span><span class="st">&quot;iptw&quot;</span>)
<span class="co">#&gt; Estimator:  iptw </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; ltmle(data = data, Anodes = &quot;A&quot;, Lnodes = NULL, Ynodes = &quot;Y&quot;, </span>
<span class="co">#&gt;     abar = 1, SL.library = &quot;default&quot;)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    Parameter Estimate:  0.56314 </span>
<span class="co">#&gt;     Estimated Std Err:  0.041376 </span>
<span class="co">#&gt;               p-value:  &lt;2e-16 </span>
<span class="co">#&gt;     95% Conf Interval: (0.48204, 0.64423)</span></code></pre></div>
<p>SuperLearner semiparametric estimation using correctly specified regressors</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">result &lt;-<span class="st"> </span><span class="kw">ltmle</span>(data, <span class="dt">Anodes=</span><span class="st">&quot;A&quot;</span>, <span class="dt">Lnodes=</span><span class="ot">NULL</span>, <span class="dt">Ynodes=</span><span class="st">&quot;Y&quot;</span>, <span class="dt">Qform=</span><span class="kw">c</span>(<span class="dt">Y=</span><span class="st">&quot;Q.kplus1 ~ I(W1^2) + W2 + W3*A&quot;</span>), <span class="dt">gform=</span><span class="st">&quot;A ~ W1 + W3&quot;</span>, <span class="dt">abar=</span><span class="dv">1</span>, <span class="dt">SL.library=</span><span class="st">&quot;default&quot;</span>)
<span class="co">#&gt; Estimate of time to completion: 1 to 2 minutes</span>
<span class="kw">summary</span>(result)
<span class="co">#&gt; Estimator:  tmle </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; ltmle(data = data, Anodes = &quot;A&quot;, Lnodes = NULL, Ynodes = &quot;Y&quot;, </span>
<span class="co">#&gt;     Qform = c(Y = &quot;Q.kplus1 ~ I(W1^2) + W2 + W3*A&quot;), gform = &quot;A ~ W1 + W3&quot;, </span>
<span class="co">#&gt;     abar = 1, SL.library = &quot;default&quot;)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    Parameter Estimate:  0.5704 </span>
<span class="co">#&gt;     Estimated Std Err:  0.032526 </span>
<span class="co">#&gt;               p-value:  &lt;2e-16 </span>
<span class="co">#&gt;     95% Conf Interval: (0.50665, 0.63415)</span></code></pre></div>
<p>glm using correctly specified Qform and gform</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">result &lt;-<span class="st"> </span><span class="kw">ltmle</span>(data, <span class="dt">Anodes=</span><span class="st">&quot;A&quot;</span>, <span class="dt">Lnodes=</span><span class="ot">NULL</span>, <span class="dt">Ynodes=</span><span class="st">&quot;Y&quot;</span>, 
 <span class="dt">Qform=</span><span class="kw">c</span>(<span class="dt">Y=</span><span class="st">&quot;Q.kplus1 ~ I(W1^2) + W2 + W3*A&quot;</span>), <span class="dt">gform=</span><span class="st">&quot;A ~ W1 + W3&quot;</span>, 
 <span class="dt">abar=</span><span class="dv">1</span>, <span class="dt">SL.library=</span><span class="ot">NULL</span>)
<span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span>
<span class="kw">summary</span>(result)
<span class="co">#&gt; Estimator:  tmle </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; ltmle(data = data, Anodes = &quot;A&quot;, Lnodes = NULL, Ynodes = &quot;Y&quot;, </span>
<span class="co">#&gt;     Qform = c(Y = &quot;Q.kplus1 ~ I(W1^2) + W2 + W3*A&quot;), gform = &quot;A ~ W1 + W3&quot;, </span>
<span class="co">#&gt;     abar = 1, SL.library = NULL)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    Parameter Estimate:  0.56989 </span>
<span class="co">#&gt;     Estimated Std Err:  0.032987 </span>
<span class="co">#&gt;               p-value:  &lt;2e-16 </span>
<span class="co">#&gt;     95% Conf Interval: (0.50524, 0.63454)</span></code></pre></div>
<p>Get summary measures (additive treatment effect, odds ratio, relative risk) for abar=1 vs abar=0</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">result &lt;-<span class="st"> </span><span class="kw">ltmle</span>(data, <span class="dt">Anodes=</span><span class="st">&quot;A&quot;</span>, <span class="dt">Lnodes=</span><span class="ot">NULL</span>, <span class="dt">Ynodes=</span><span class="st">&quot;Y&quot;</span>, 
                      <span class="dt">abar=</span><span class="kw">list</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="dt">SL.library=</span><span class="st">&quot;default&quot;</span>)
<span class="co">#&gt; Qform not specified, using defaults:</span>
<span class="co">#&gt; formula for Y:</span>
<span class="co">#&gt; Q.kplus1 ~ W1 + W2 + W3 + A</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; gform not specified, using defaults:</span>
<span class="co">#&gt; formula for A:</span>
<span class="co">#&gt; A ~ W1 + W2 + W3</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimate of time to completion: 1 minute</span>
<span class="kw">summary</span>(result)
<span class="co">#&gt; Estimator:  tmle </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; ltmle(data = data, Anodes = &quot;A&quot;, Lnodes = NULL, Ynodes = &quot;Y&quot;, </span>
<span class="co">#&gt;     abar = list(1, 0), SL.library = &quot;default&quot;)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Treatment Estimate:</span>
<span class="co">#&gt;    Parameter Estimate:  0.57138 </span>
<span class="co">#&gt;     Estimated Std Err:  0.045835 </span>
<span class="co">#&gt;               p-value:  &lt;2e-16 </span>
<span class="co">#&gt;     95% Conf Interval: (0.48155, 0.66121) </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Control Estimate:</span>
<span class="co">#&gt;    Parameter Estimate:  0.64113 </span>
<span class="co">#&gt;     Estimated Std Err:  0.029054 </span>
<span class="co">#&gt;               p-value:  &lt;2e-16 </span>
<span class="co">#&gt;     95% Conf Interval: (0.58418, 0.69807) </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Additive Treatment Effect:</span>
<span class="co">#&gt;    Parameter Estimate:  -0.069747 </span>
<span class="co">#&gt;     Estimated Std Err:  0.054267 </span>
<span class="co">#&gt;               p-value:  0.19871 </span>
<span class="co">#&gt;     95% Conf Interval: (-0.17611, 0.036615) </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Relative Risk:</span>
<span class="co">#&gt;    Parameter Estimate:  0.89121 </span>
<span class="co">#&gt;   Est Std Err log(RR):  0.092133 </span>
<span class="co">#&gt;               p-value:  0.21127 </span>
<span class="co">#&gt;     95% Conf Interval: (0.74397, 1.0676) </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Odds Ratio:</span>
<span class="co">#&gt;    Parameter Estimate:  0.74619 </span>
<span class="co">#&gt;   Est Std Err log(OR):  0.22577 </span>
<span class="co">#&gt;               p-value:  0.1947 </span>
<span class="co">#&gt;     95% Conf Interval: (0.47937, 1.1615)</span></code></pre></div>
</div>
<div id="censoring" class="section level2">
<h2>Censoring</h2>
<p>W -&gt; C -&gt; Y</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n &lt;-<span class="st"> </span><span class="dv">100000</span>
W &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n)
C &lt;-<span class="st"> </span><span class="kw">BinaryToCensoring</span>(<span class="dt">is.censored =</span> <span class="kw">rexpit</span>(W))
<span class="kw">summary</span>(C)
<span class="co">#&gt;   censored uncensored </span>
<span class="co">#&gt;      50250      49750</span>
Y &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, n)
Y[C <span class="op">==</span><span class="st"> &quot;uncensored&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rexpit</span>(W[C <span class="op">==</span><span class="st"> &quot;uncensored&quot;</span>])
data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(W, C, Y)
<span class="kw">head</span>(data, <span class="dv">20</span>)
<span class="co">#&gt;              W          C  Y</span>
<span class="co">#&gt; 1  -1.45413129 uncensored  0</span>
<span class="co">#&gt; 2   0.30688155   censored NA</span>
<span class="co">#&gt; 3   0.18436211 uncensored  0</span>
<span class="co">#&gt; 4   2.63220559   censored NA</span>
<span class="co">#&gt; 5   0.06226389   censored NA</span>
<span class="co">#&gt; 6  -0.98000361 uncensored  0</span>
<span class="co">#&gt; 7  -0.75216061   censored NA</span>
<span class="co">#&gt; 8   0.17447522 uncensored  0</span>
<span class="co">#&gt; 9   0.82629861 uncensored  1</span>
<span class="co">#&gt; 10 -0.12580620   censored NA</span>
<span class="co">#&gt; 11  0.39912332 uncensored  1</span>
<span class="co">#&gt; 12  1.06281789   censored NA</span>
<span class="co">#&gt; 13  1.74256155   censored NA</span>
<span class="co">#&gt; 14 -0.46341228   censored NA</span>
<span class="co">#&gt; 15 -1.00158951 uncensored  0</span>
<span class="co">#&gt; 16  0.71331590 uncensored  1</span>
<span class="co">#&gt; 17  0.06635228 uncensored  1</span>
<span class="co">#&gt; 18  2.08868578   censored NA</span>
<span class="co">#&gt; 19  1.58309639 uncensored  1</span>
<span class="co">#&gt; 20  1.28009430   censored NA</span>
result &lt;-<span class="st"> </span><span class="kw">ltmle</span>(data, <span class="dt">Anodes =</span> <span class="ot">NULL</span>, <span class="dt">Cnodes =</span> <span class="st">&quot;C&quot;</span>, <span class="dt">Ynodes =</span> <span class="st">&quot;Y&quot;</span>, <span class="dt">abar =</span> <span class="ot">NULL</span>)
<span class="co">#&gt; Qform not specified, using defaults:</span>
<span class="co">#&gt; formula for Y:</span>
<span class="co">#&gt; Q.kplus1 ~ W</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; gform not specified, using defaults:</span>
<span class="co">#&gt; formula for C:</span>
<span class="co">#&gt; C ~ W</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimate of time to completion: 1 minute</span>
<span class="kw">summary</span>(result)
<span class="co">#&gt; Estimator:  tmle </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; ltmle(data = data, Anodes = NULL, Cnodes = &quot;C&quot;, Ynodes = &quot;Y&quot;, </span>
<span class="co">#&gt;     abar = NULL)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    Parameter Estimate:  0.50161 </span>
<span class="co">#&gt;     Estimated Std Err:  0.0023267 </span>
<span class="co">#&gt;               p-value:  &lt;2e-16 </span>
<span class="co">#&gt;     95% Conf Interval: (0.49705, 0.50617)</span></code></pre></div>
<p>The naive estimate is biased:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(data<span class="op">$</span>Y)
<span class="co">#&gt; [1] NA</span>
<span class="kw">mean</span>(data<span class="op">$</span>Y, <span class="dt">na.rm =</span> T)
<span class="co">#&gt; [1] 0.4149749</span></code></pre></div>
</div>
<div id="longitudinal-data" class="section level2">
<h2>Longitudinal data</h2>
<p>W -&gt; A1 -&gt; L -&gt; A2 -&gt; Y</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n &lt;-<span class="st"> </span><span class="dv">1000</span>
W &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n)
A1 &lt;-<span class="st"> </span><span class="kw">rexpit</span>(W)
L &lt;-<span class="st"> </span><span class="fl">0.3</span> <span class="op">*</span><span class="st"> </span>W <span class="op">+</span><span class="st"> </span><span class="fl">0.2</span> <span class="op">*</span><span class="st"> </span>A1 <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n)
A2 &lt;-<span class="st"> </span><span class="kw">rexpit</span>(W <span class="op">+</span><span class="st"> </span>A1 <span class="op">+</span><span class="st"> </span>L)
Y &lt;-<span class="st"> </span><span class="kw">rexpit</span>(W <span class="op">-</span><span class="st"> </span><span class="fl">0.6</span> <span class="op">*</span><span class="st"> </span>A1 <span class="op">+</span><span class="st"> </span>L <span class="op">-</span><span class="st"> </span><span class="fl">0.8</span> <span class="op">*</span><span class="st"> </span>A2)
data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(W, A1, L, A2, Y)</code></pre></div>
<p>Treatment regime of interest: set all A1 to 1, set all A2 to 0:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">result.<span class="fl">1.0</span> &lt;-<span class="st"> </span><span class="kw">ltmle</span>(data, <span class="dt">Anodes=</span><span class="kw">c</span>(<span class="st">&quot;A1&quot;</span>, <span class="st">&quot;A2&quot;</span>), <span class="dt">Lnodes=</span><span class="st">&quot;L&quot;</span>, <span class="dt">Ynodes=</span><span class="st">&quot;Y&quot;</span>, <span class="dt">abar=</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>))
<span class="co">#&gt; Qform not specified, using defaults:</span>
<span class="co">#&gt; formula for L:</span>
<span class="co">#&gt; Q.kplus1 ~ W + A1</span>
<span class="co">#&gt; formula for Y:</span>
<span class="co">#&gt; Q.kplus1 ~ W + A1 + L + A2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; gform not specified, using defaults:</span>
<span class="co">#&gt; formula for A1:</span>
<span class="co">#&gt; A1 ~ W</span>
<span class="co">#&gt; formula for A2:</span>
<span class="co">#&gt; A2 ~ W + A1 + L</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span>
result.<span class="fl">1.0</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; ltmle(data = data, Anodes = c(&quot;A1&quot;, &quot;A2&quot;), Lnodes = &quot;L&quot;, Ynodes = &quot;Y&quot;, </span>
<span class="co">#&gt;     abar = c(1, 0))</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; TMLE Estimate:  0.4367909</span></code></pre></div>
</div>
<div id="dynamic-treatment" class="section level2">
<h2>Dynamic treatment</h2>
<p>Treatment regime of interest is: Always treat at time 1 (A1 = 1), treat at at time 2 (A2 = 1) if L &gt; 0</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">abar &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dt">nrow=</span>n, <span class="dt">ncol=</span><span class="dv">2</span>)
abar[, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">1</span>
abar[, <span class="dv">2</span>] &lt;-<span class="st"> </span>L <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>

result.abar &lt;-<span class="st"> </span><span class="kw">ltmle</span>(data, <span class="dt">Anodes=</span><span class="kw">c</span>(<span class="st">&quot;A1&quot;</span>, <span class="st">&quot;A2&quot;</span>), <span class="dt">Lnodes=</span><span class="st">&quot;L&quot;</span>, <span class="dt">Ynodes=</span><span class="st">&quot;Y&quot;</span>, <span class="dt">abar=</span>abar)
<span class="co">#&gt; Qform not specified, using defaults:</span>
<span class="co">#&gt; formula for L:</span>
<span class="co">#&gt; Q.kplus1 ~ W + A1</span>
<span class="co">#&gt; formula for Y:</span>
<span class="co">#&gt; Q.kplus1 ~ W + A1 + L + A2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; gform not specified, using defaults:</span>
<span class="co">#&gt; formula for A1:</span>
<span class="co">#&gt; A1 ~ W</span>
<span class="co">#&gt; formula for A2:</span>
<span class="co">#&gt; A2 ~ W + A1 + L</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span>
result.abar
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; ltmle(data = data, Anodes = c(&quot;A1&quot;, &quot;A2&quot;), Lnodes = &quot;L&quot;, Ynodes = &quot;Y&quot;, </span>
<span class="co">#&gt;     abar = abar)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; TMLE Estimate:  0.3638237</span></code></pre></div>
<p>The regime can also be specified as a rule function</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rule &lt;-<span class="st"> </span><span class="cf">function</span>(row) <span class="kw">c</span>(<span class="dv">1</span>, row[<span class="st">&quot;L&quot;</span>] <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)

result.rule &lt;-<span class="st"> </span><span class="kw">ltmle</span>(data, <span class="dt">Anodes=</span><span class="kw">c</span>(<span class="st">&quot;A1&quot;</span>, <span class="st">&quot;A2&quot;</span>), <span class="dt">Lnodes=</span><span class="st">&quot;L&quot;</span>, <span class="dt">Ynodes=</span><span class="st">&quot;Y&quot;</span>, <span class="dt">rule=</span>rule)
<span class="co">#&gt; Qform not specified, using defaults:</span>
<span class="co">#&gt; formula for L:</span>
<span class="co">#&gt; Q.kplus1 ~ W + A1</span>
<span class="co">#&gt; formula for Y:</span>
<span class="co">#&gt; Q.kplus1 ~ W + A1 + L + A2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; gform not specified, using defaults:</span>
<span class="co">#&gt; formula for A1:</span>
<span class="co">#&gt; A1 ~ W</span>
<span class="co">#&gt; formula for A2:</span>
<span class="co">#&gt; A2 ~ W + A1 + L</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span>
result.rule
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; ltmle(data = data, Anodes = c(&quot;A1&quot;, &quot;A2&quot;), Lnodes = &quot;L&quot;, Ynodes = &quot;Y&quot;, </span>
<span class="co">#&gt;     rule = rule)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; TMLE Estimate:  0.3638237</span></code></pre></div>
<p>Specfifying the regime using abar and using rule give the same result:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(result.abar)
<span class="co">#&gt; Estimator:  tmle </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; ltmle(data = data, Anodes = c(&quot;A1&quot;, &quot;A2&quot;), Lnodes = &quot;L&quot;, Ynodes = &quot;Y&quot;, </span>
<span class="co">#&gt;     abar = abar)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    Parameter Estimate:  0.36382 </span>
<span class="co">#&gt;     Estimated Std Err:  0.027101 </span>
<span class="co">#&gt;               p-value:  &lt;2e-16 </span>
<span class="co">#&gt;     95% Conf Interval: (0.31071, 0.41694)</span>
<span class="kw">summary</span>(result.rule)
<span class="co">#&gt; Estimator:  tmle </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; ltmle(data = data, Anodes = c(&quot;A1&quot;, &quot;A2&quot;), Lnodes = &quot;L&quot;, Ynodes = &quot;Y&quot;, </span>
<span class="co">#&gt;     rule = rule)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    Parameter Estimate:  0.36382 </span>
<span class="co">#&gt;     Estimated Std Err:  0.027101 </span>
<span class="co">#&gt;               p-value:  &lt;2e-16 </span>
<span class="co">#&gt;     95% Conf Interval: (0.31071, 0.41694)</span></code></pre></div>
</div>
<div id="variance-estimation" class="section level2">
<h2>Variance estimation</h2>
<p>A simple point treatment problem W, A, Y. But there is a positivity problem - for small values of W, Prob(A = 1) is very small.</p>
<p>The true parameter value, <span class="math inline">\(E[Y_1]\)</span> is approximately 0.697.</p>
<p>The true TMLE standard deviation is approximately 0.064.</p>
<p>The true IPTW standard deviation is approximately 0.058.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n &lt;-<span class="st"> </span><span class="dv">1000</span>
W &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n)
A &lt;-<span class="st"> </span><span class="kw">rexpit</span>(<span class="dv">8</span> <span class="op">*</span><span class="st"> </span>W)
Y &lt;-<span class="st"> </span><span class="kw">rexpit</span>(W <span class="op">+</span><span class="st"> </span>A)
r1 &lt;-<span class="st"> </span><span class="kw">ltmle</span>(<span class="kw">data.frame</span>(W, A, Y), <span class="dt">Anodes=</span><span class="st">&quot;A&quot;</span>, <span class="dt">Ynodes=</span><span class="st">&quot;Y&quot;</span>, <span class="dt">abar =</span> <span class="dv">1</span>, <span class="dt">estimate.time=</span><span class="ot">FALSE</span>)
<span class="co">#&gt; Qform not specified, using defaults:</span>
<span class="co">#&gt; formula for Y:</span>
<span class="co">#&gt; Q.kplus1 ~ W + A</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; gform not specified, using defaults:</span>
<span class="co">#&gt; formula for A:</span>
<span class="co">#&gt; A ~ W</span>
<span class="co">#&gt; </span>
r2 &lt;-<span class="st"> </span><span class="kw">ltmle</span>(<span class="kw">data.frame</span>(W, A, Y), <span class="dt">Anodes=</span><span class="st">&quot;A&quot;</span>, <span class="dt">Ynodes=</span><span class="st">&quot;Y&quot;</span>, <span class="dt">abar =</span> <span class="dv">1</span>, <span class="dt">estimate.time=</span><span class="ot">FALSE</span>, 
 <span class="dt">variance.method=</span><span class="st">&quot;ic&quot;</span>)
<span class="co">#&gt; Qform not specified, using defaults:</span>
<span class="co">#&gt; formula for Y:</span>
<span class="co">#&gt; Q.kplus1 ~ W + A</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; gform not specified, using defaults:</span>
<span class="co">#&gt; formula for A:</span>
<span class="co">#&gt; A ~ W</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Warning in CheckForVarianceWarning(inputs, g.ratio): Variance estimate is</span>
<span class="co">#&gt; based on influence curve only, which may be significantly anticonservative</span>
<span class="co">#&gt; because your data appears to contain positivity violations. It is</span>
<span class="co">#&gt; recommended to use variance.method='tmle' or variance.method='iptw' to</span>
<span class="co">#&gt; obtain a more robust variance estimate (but run time may be significantly</span>
<span class="co">#&gt; longer). See variance.method details in ?ltmle</span>
r3 &lt;-<span class="st"> </span><span class="kw">ltmle</span>(<span class="kw">data.frame</span>(W, A, Y), <span class="dt">Anodes=</span><span class="st">&quot;A&quot;</span>, <span class="dt">Ynodes=</span><span class="st">&quot;Y&quot;</span>, <span class="dt">abar =</span> <span class="dv">1</span>, <span class="dt">estimate.time=</span><span class="ot">FALSE</span>, 
 <span class="dt">variance.method=</span><span class="st">&quot;iptw&quot;</span>)
<span class="co">#&gt; Qform not specified, using defaults:</span>
<span class="co">#&gt; formula for Y:</span>
<span class="co">#&gt; Q.kplus1 ~ W + A</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; gform not specified, using defaults:</span>
<span class="co">#&gt; formula for A:</span>
<span class="co">#&gt; A ~ W</span>
<span class="co">#&gt; </span>
<span class="kw">print</span>(<span class="kw">summary</span>(r1))
<span class="co">#&gt; Estimator:  tmle </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; ltmle(data = data.frame(W, A, Y), Anodes = &quot;A&quot;, Ynodes = &quot;Y&quot;, </span>
<span class="co">#&gt;     abar = 1, estimate.time = FALSE)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    Parameter Estimate:  0.70559 </span>
<span class="co">#&gt;     Estimated Std Err:  0.061902 </span>
<span class="co">#&gt;               p-value:  &lt;2e-16 </span>
<span class="co">#&gt;     95% Conf Interval: (0.58427, 0.82692)</span>
<span class="kw">print</span>(<span class="kw">summary</span>(r2))
<span class="co">#&gt; Estimator:  tmle </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; ltmle(data = data.frame(W, A, Y), Anodes = &quot;A&quot;, Ynodes = &quot;Y&quot;, </span>
<span class="co">#&gt;     abar = 1, estimate.time = FALSE, variance.method = &quot;ic&quot;)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    Parameter Estimate:  0.70559 </span>
<span class="co">#&gt;     Estimated Std Err:  0.021569 </span>
<span class="co">#&gt;               p-value:  &lt;2e-16 </span>
<span class="co">#&gt;     95% Conf Interval: (0.66332, 0.74787)</span>
<span class="kw">print</span>(<span class="kw">summary</span>(r3))
<span class="co">#&gt; Estimator:  tmle </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; ltmle(data = data.frame(W, A, Y), Anodes = &quot;A&quot;, Ynodes = &quot;Y&quot;, </span>
<span class="co">#&gt;     abar = 1, estimate.time = FALSE, variance.method = &quot;iptw&quot;)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    Parameter Estimate:  0.70559 </span>
<span class="co">#&gt;     Estimated Std Err:  0.033384 </span>
<span class="co">#&gt;               p-value:  &lt;2e-16 </span>
<span class="co">#&gt;     95% Conf Interval: (0.64016, 0.77103)</span>
<span class="kw">print</span>(<span class="kw">summary</span>(r1, <span class="dt">estimator=</span><span class="st">&quot;iptw&quot;</span>))
<span class="co">#&gt; Estimator:  iptw </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; ltmle(data = data.frame(W, A, Y), Anodes = &quot;A&quot;, Ynodes = &quot;Y&quot;, </span>
<span class="co">#&gt;     abar = 1, estimate.time = FALSE)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    Parameter Estimate:  0.79957 </span>
<span class="co">#&gt;     Estimated Std Err:  0.022348 </span>
<span class="co">#&gt;               p-value:  &lt;2e-16 </span>
<span class="co">#&gt;     95% Conf Interval: (0.75577, 0.84337)</span>
<span class="kw">print</span>(<span class="kw">summary</span>(r2, <span class="dt">estimator=</span><span class="st">&quot;iptw&quot;</span>)) <span class="co">#the same - variance.method only affects TMLE</span>
<span class="co">#&gt; Estimator:  iptw </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; ltmle(data = data.frame(W, A, Y), Anodes = &quot;A&quot;, Ynodes = &quot;Y&quot;, </span>
<span class="co">#&gt;     abar = 1, estimate.time = FALSE, variance.method = &quot;ic&quot;)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    Parameter Estimate:  0.79957 </span>
<span class="co">#&gt;     Estimated Std Err:  0.022348 </span>
<span class="co">#&gt;               p-value:  &lt;2e-16 </span>
<span class="co">#&gt;     95% Conf Interval: (0.75577, 0.84337)</span>
<span class="kw">print</span>(<span class="kw">summary</span>(r3, <span class="dt">estimator=</span><span class="st">&quot;iptw&quot;</span>)) <span class="co">#the same - variance.method only affects TMLE</span>
<span class="co">#&gt; Estimator:  iptw </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; ltmle(data = data.frame(W, A, Y), Anodes = &quot;A&quot;, Ynodes = &quot;Y&quot;, </span>
<span class="co">#&gt;     abar = 1, estimate.time = FALSE, variance.method = &quot;iptw&quot;)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    Parameter Estimate:  0.79957 </span>
<span class="co">#&gt;     Estimated Std Err:  0.022348 </span>
<span class="co">#&gt;               p-value:  &lt;2e-16 </span>
<span class="co">#&gt;     95% Conf Interval: (0.75577, 0.84337)</span></code></pre></div>
<p>We can see that the values of g are very small.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(r1<span class="op">$</span>cum.g)
<span class="co">#&gt;        V1        </span>
<span class="co">#&gt;  Min.   :0.0100  </span>
<span class="co">#&gt;  1st Qu.:0.0100  </span>
<span class="co">#&gt;  Median :0.5003  </span>
<span class="co">#&gt;  Mean   :0.5035  </span>
<span class="co">#&gt;  3rd Qu.:0.9967  </span>
<span class="co">#&gt;  Max.   :1.0000</span>
<span class="kw">summary</span>(r1<span class="op">$</span>cum.g.unbounded)
<span class="co">#&gt;        V1          </span>
<span class="co">#&gt;  Min.   :0.000000  </span>
<span class="co">#&gt;  1st Qu.:0.004268  </span>
<span class="co">#&gt;  Median :0.500255  </span>
<span class="co">#&gt;  Mean   :0.501000  </span>
<span class="co">#&gt;  3rd Qu.:0.996708  </span>
<span class="co">#&gt;  Max.   :1.000000</span>
<span class="kw">head</span>(<span class="kw">data.frame</span>(data, <span class="dt">g =</span> r1<span class="op">$</span>cum.g, <span class="dt">g.unbounded =</span> r1<span class="op">$</span>cum.g.unbounded), <span class="dv">20</span>)
<span class="co">#&gt;              W A1           L A2 Y          g  g.unbounded</span>
<span class="co">#&gt; 1  -1.20573542  0  0.39581728  1 0 0.97946069 9.794607e-01</span>
<span class="co">#&gt; 2  -0.11847809  0 -1.85463574  0 0 0.98262162 9.826216e-01</span>
<span class="co">#&gt; 3  -1.07449828  0 -0.60210049  0 0 0.89928578 8.992858e-01</span>
<span class="co">#&gt; 4   0.14959645  0 -2.15612928  0 0 0.99919151 9.991915e-01</span>
<span class="co">#&gt; 5  -0.09924607  1  0.37076323  0 0 0.41828112 4.182811e-01</span>
<span class="co">#&gt; 6  -0.21997262  0  0.29511068  0 1 0.02056625 2.056625e-02</span>
<span class="co">#&gt; 7  -0.40776705  1 -1.22315579  0 1 0.99999214 9.999921e-01</span>
<span class="co">#&gt; 8  -1.04285658  0  0.09105349  0 0 0.09265989 9.265989e-02</span>
<span class="co">#&gt; 9   0.40278767  0  0.02907726  1 1 0.99991550 9.999155e-01</span>
<span class="co">#&gt; 10  0.90752206  1  0.65232435  1 1 0.94925366 9.492537e-01</span>
<span class="co">#&gt; 11 -0.48329380  1 -0.25679883  0 1 0.01967918 1.967918e-02</span>
<span class="co">#&gt; 12  0.49421470  1  0.38044406  1 0 0.01000000 1.779752e-04</span>
<span class="co">#&gt; 13 -0.89599532  1 -0.83443405  0 0 0.01000000 2.081218e-05</span>
<span class="co">#&gt; 14 -0.56313947  1  0.53727874  0 0 0.99941902 9.994190e-01</span>
<span class="co">#&gt; 15 -0.71826032  0  0.76740665  1 0 0.68918104 6.891810e-01</span>
<span class="co">#&gt; 16 -0.06871387  1  1.38592910  1 1 0.03380278 3.380278e-02</span>
<span class="co">#&gt; 17  0.27635264  1  0.08097210  1 0 0.01612997 1.612997e-02</span>
<span class="co">#&gt; 18  0.91849604  1 -0.87734697  1 0 0.99915165 9.991516e-01</span>
<span class="co">#&gt; 19 -1.72830919  0 -1.78502844  0 0 0.01000000 2.334893e-06</span>
<span class="co">#&gt; 20 -0.32355003  0 -1.41524273  0 0 0.99904235 9.990424e-01</span></code></pre></div>
</div>
<div id="hierachical-data-and-the-id-variable" class="section level2">
<h2>Hierachical data and the id variable</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">num.households &lt;-<span class="st"> </span><span class="dv">500</span>
people.in.household &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">runif</span>(num.households, <span class="dt">min =</span> <span class="dv">1</span>, <span class="dt">max =</span> <span class="dv">10</span>))
<span class="kw">length</span>(people.in.household)
<span class="co">#&gt; [1] 500</span>
n &lt;-<span class="st"> </span><span class="kw">sum</span>(people.in.household) 
n
<span class="co">#&gt; [1] 2819</span>
W.household &lt;-<span class="st"> </span><span class="kw">rnorm</span>(num.households)
<span class="kw">length</span>(W.household)
<span class="co">#&gt; [1] 500</span>
W.household.expanded &lt;-<span class="st"> </span><span class="kw">rep</span>(W.household, <span class="dt">times =</span> people.in.household)
W.indiv &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n)
<span class="kw">length</span>(W.indiv)
<span class="co">#&gt; [1] 2819</span>
A &lt;-<span class="st"> </span><span class="kw">rexpit</span>(<span class="fl">1.5</span> <span class="op">*</span><span class="st"> </span>W.household.expanded <span class="op">+</span><span class="st"> </span><span class="fl">0.4</span> <span class="op">*</span><span class="st"> </span>W.indiv)
Y &lt;-<span class="st"> </span><span class="kw">rexpit</span>(<span class="op">-</span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="fl">2.3</span> <span class="op">*</span><span class="st"> </span>W.household.expanded <span class="op">-</span><span class="st"> </span><span class="fl">0.6</span> <span class="op">*</span><span class="st"> </span>W.indiv <span class="op">+</span><span class="st"> </span><span class="fl">1.2</span> <span class="op">*</span><span class="st"> </span>A)</code></pre></div>
<p>id can be an integer, factor, or character (or any type that can be coerced to factor)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">id &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span>num.households 
id.expanded &lt;-<span class="st"> </span><span class="kw">rep</span>(id, <span class="dt">times =</span> people.in.household)
data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(W.household.expanded, W.indiv, A, Y)
<span class="kw">head</span>(<span class="kw">cbind</span>(id.expanded, data), <span class="dv">20</span>)
<span class="co">#&gt;    id.expanded W.household.expanded     W.indiv A Y</span>
<span class="co">#&gt; 1            1            1.6166479  1.95697132 1 1</span>
<span class="co">#&gt; 2            1            1.6166479 -0.00953674 1 1</span>
<span class="co">#&gt; 3            1            1.6166479 -0.57487974 1 1</span>
<span class="co">#&gt; 4            1            1.6166479 -0.62290483 1 1</span>
<span class="co">#&gt; 5            1            1.6166479 -0.58566766 1 1</span>
<span class="co">#&gt; 6            2            2.0432776  0.69964453 1 1</span>
<span class="co">#&gt; 7            2            2.0432776  1.04830599 1 1</span>
<span class="co">#&gt; 8            2            2.0432776  0.64092397 1 1</span>
<span class="co">#&gt; 9            2            2.0432776  1.01292100 1 0</span>
<span class="co">#&gt; 10           2            2.0432776  0.59748767 1 1</span>
<span class="co">#&gt; 11           2            2.0432776  0.04699455 1 1</span>
<span class="co">#&gt; 12           2            2.0432776  1.58401028 1 1</span>
<span class="co">#&gt; 13           3            2.3382099 -2.57842418 1 1</span>
<span class="co">#&gt; 14           3            2.3382099  0.02372008 0 1</span>
<span class="co">#&gt; 15           3            2.3382099 -1.61901885 1 1</span>
<span class="co">#&gt; 16           3            2.3382099 -0.03304178 1 1</span>
<span class="co">#&gt; 17           4           -0.3260854 -0.43752610 1 1</span>
<span class="co">#&gt; 18           4           -0.3260854  0.60881302 0 0</span>
<span class="co">#&gt; 19           4           -0.3260854  0.38024218 0 0</span>
<span class="co">#&gt; 20           4           -0.3260854 -0.95069545 0 0</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">result.without.id &lt;-<span class="st"> </span><span class="kw">ltmle</span>(data, <span class="dt">Anodes =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">Ynodes =</span> <span class="st">&quot;Y&quot;</span>, <span class="dt">abar =</span> <span class="dv">0</span>)
<span class="co">#&gt; Qform not specified, using defaults:</span>
<span class="co">#&gt; formula for Y:</span>
<span class="co">#&gt; Q.kplus1 ~ W.household.expanded + W.indiv + A</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; gform not specified, using defaults:</span>
<span class="co">#&gt; formula for A:</span>
<span class="co">#&gt; A ~ W.household.expanded + W.indiv</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span>
result.with.id &lt;-<span class="st"> </span><span class="kw">ltmle</span>(data, <span class="dt">Anodes =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">Ynodes =</span> <span class="st">&quot;Y&quot;</span>, <span class="dt">abar =</span> <span class="dv">0</span>, <span class="dt">id =</span> id.expanded)
<span class="co">#&gt; Qform not specified, using defaults:</span>
<span class="co">#&gt; formula for Y:</span>
<span class="co">#&gt; Q.kplus1 ~ W.household.expanded + W.indiv + A</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; gform not specified, using defaults:</span>
<span class="co">#&gt; formula for A:</span>
<span class="co">#&gt; A ~ W.household.expanded + W.indiv</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span></code></pre></div>
<p>Omitting the id variable makes the individuals seem more independent than they are, which gives artificially low variance estimates.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(result.without.id)
<span class="co">#&gt; Estimator:  tmle </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; ltmle(data = data, Anodes = &quot;A&quot;, Ynodes = &quot;Y&quot;, abar = 0)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    Parameter Estimate:  0.3838 </span>
<span class="co">#&gt;     Estimated Std Err:  0.015671 </span>
<span class="co">#&gt;               p-value:  &lt;2e-16 </span>
<span class="co">#&gt;     95% Conf Interval: (0.35308, 0.41451)</span>
<span class="kw">summary</span>(result.with.id)
<span class="co">#&gt; Estimator:  tmle </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; ltmle(data = data, Anodes = &quot;A&quot;, Ynodes = &quot;Y&quot;, abar = 0, id = id.expanded)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    Parameter Estimate:  0.3838 </span>
<span class="co">#&gt;     Estimated Std Err:  0.021411 </span>
<span class="co">#&gt;               p-value:  &lt;2e-16 </span>
<span class="co">#&gt;     95% Conf Interval: (0.34183, 0.42576)</span></code></pre></div>
<p>The influence curve is a vector with length equal to the number of independent units.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">length</span>(result.without.id<span class="op">$</span>IC<span class="op">$</span>tmle)
<span class="co">#&gt; [1] 2819</span>
<span class="kw">length</span>(result.with.id<span class="op">$</span>IC<span class="op">$</span>tmle)
<span class="co">#&gt; [1] 500</span></code></pre></div>
</div>
<div id="multiple-time-dependent-covariates-and-treatments-at-each-time-point-continuous-y-values" class="section level2">
<h2>Multiple time-dependent covariates and treatments at each time point, continuous Y values</h2>
<p>age -&gt; gender -&gt; A1 -&gt; L1a -&gt; L1b -&gt; Y1 -&gt; A2 -&gt; L2a -&gt; L2b -&gt; Y2</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">2</span>)
n &lt;-<span class="st"> </span><span class="dv">1000</span>
age &lt;-<span class="st"> </span><span class="kw">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.5</span>)
gender &lt;-<span class="st"> </span><span class="kw">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.5</span>)
A1 &lt;-<span class="st"> </span><span class="kw">rexpit</span>(age <span class="op">+</span><span class="st"> </span>gender)
L1a &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span>age <span class="op">-</span><span class="st"> </span><span class="dv">3</span><span class="op">*</span>gender <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>A1 <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n)
L1b &lt;-<span class="st"> </span><span class="kw">rexpit</span>(age <span class="op">+</span><span class="st"> </span><span class="fl">1.5</span><span class="op">*</span>gender <span class="op">-</span><span class="st"> </span>A1)
Y1 &lt;-<span class="st"> </span><span class="kw">plogis</span>(age <span class="op">-</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>L1a <span class="op">+</span><span class="st"> </span><span class="fl">0.7</span><span class="op">*</span>L1b <span class="op">+</span><span class="st"> </span>A1 <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n))
A2 &lt;-<span class="st"> </span><span class="kw">rexpit</span>(age <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>A1 <span class="op">-</span><span class="st"> </span>L1a <span class="op">-</span><span class="st"> </span>L1b)
L2a &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span>age <span class="op">-</span><span class="st"> </span><span class="dv">3</span><span class="op">*</span>gender <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>A1 <span class="op">+</span><span class="st"> </span>A2 <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n)
L2b &lt;-<span class="st"> </span><span class="kw">rexpit</span>(age <span class="op">+</span><span class="st"> </span><span class="fl">1.5</span><span class="op">*</span>gender <span class="op">-</span><span class="st"> </span>A1 <span class="op">-</span><span class="st"> </span>A2)
Y2 &lt;-<span class="st"> </span><span class="kw">plogis</span>(age <span class="op">-</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>L1a <span class="op">+</span><span class="st"> </span>L1b <span class="op">+</span><span class="st"> </span>A1 <span class="op">+</span><span class="st"> </span><span class="fl">1.8</span><span class="op">*</span>A2 <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n))
data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(age, gender, A1, L1a, L1b, Y1, A2, L2a, L2b, Y2)</code></pre></div>
<p>Also show some different ways of specifying the nodes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">result5a &lt;-<span class="st"> </span><span class="kw">ltmle</span>(data, <span class="dt">Anodes=</span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">7</span>), <span class="dt">Lnodes=</span><span class="kw">c</span>(<span class="st">&quot;L1a&quot;</span>, <span class="st">&quot;L1b&quot;</span>, <span class="st">&quot;L2a&quot;</span>, <span class="st">&quot;L2b&quot;</span>), 
 <span class="dt">Ynodes=</span><span class="kw">grep</span>(<span class="st">&quot;^Y&quot;</span>, <span class="kw">names</span>(data)), <span class="dt">abar=</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>)) 
<span class="co">#&gt; Qform not specified, using defaults:</span>
<span class="co">#&gt; formula for L1a:</span>
<span class="co">#&gt; Q.kplus1 ~ age + gender + A1</span>
<span class="co">#&gt; formula for L2a:</span>
<span class="co">#&gt; Q.kplus1 ~ age + gender + A1 + L1a + L1b + Y1 + A2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; gform not specified, using defaults:</span>
<span class="co">#&gt; formula for A1:</span>
<span class="co">#&gt; A1 ~ age + gender</span>
<span class="co">#&gt; formula for A2:</span>
<span class="co">#&gt; A2 ~ age + gender + A1 + L1a + L1b + Y1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span>
<span class="co">#&gt; Warning in CheckForVarianceWarning(inputs, g.ratio): Variance estimate is</span>
<span class="co">#&gt; based on influence curve only, which may be significantly anticonservative</span>
<span class="co">#&gt; because your data appears to contain positivity violations. Robust variance</span>
<span class="co">#&gt; estimate is not currently available with non binary outcomes but this will</span>
<span class="co">#&gt; be addressed in a future release.</span>
<span class="kw">summary</span>(result5a)
<span class="co">#&gt; Estimator:  tmle </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; ltmle(data = data, Anodes = c(3, 7), Lnodes = c(&quot;L1a&quot;, &quot;L1b&quot;, </span>
<span class="co">#&gt;     &quot;L2a&quot;, &quot;L2b&quot;), Ynodes = grep(&quot;^Y&quot;, names(data)), abar = c(1, </span>
<span class="co">#&gt;     0))</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    Parameter Estimate:  0.82598 </span>
<span class="co">#&gt;     Estimated Std Err:  0.012481 </span>
<span class="co">#&gt;               p-value:  &lt;2e-16 </span>
<span class="co">#&gt;     95% Conf Interval: (0.80152, 0.85044)</span></code></pre></div>
<p>Usually you would specify a Qform for all of the Lnodes and Ynodes but in this case L1a, L1b, Y1 is a “block” of L/Y nodes not separated by Anodes or Cnodes (the same is true for L2a, L2b, Y2). Only one regression is required at the first L/Y node in a block. You can pass regression formulas for the other L/Y nodes, but they’ll be ignored.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">result5b &lt;-<span class="st"> </span><span class="kw">ltmle</span>(data, <span class="dt">Anodes=</span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">7</span>), <span class="dt">Lnodes=</span><span class="kw">c</span>(<span class="st">&quot;L1a&quot;</span>, <span class="st">&quot;L1b&quot;</span>, <span class="st">&quot;L2a&quot;</span>, <span class="st">&quot;L2b&quot;</span>), 
 <span class="dt">Ynodes=</span><span class="kw">grep</span>(<span class="st">&quot;^Y&quot;</span>, <span class="kw">names</span>(data)), <span class="dt">abar=</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), 
 <span class="dt">Qform=</span><span class="kw">c</span>(<span class="dt">L1a=</span><span class="st">&quot;Q.kplus1 ~ 1&quot;</span>, <span class="dt">L2a=</span><span class="st">&quot;Q.kplus1 ~ 1&quot;</span>))
<span class="co">#&gt; gform not specified, using defaults:</span>
<span class="co">#&gt; formula for A1:</span>
<span class="co">#&gt; A1 ~ age + gender</span>
<span class="co">#&gt; formula for A2:</span>
<span class="co">#&gt; A2 ~ age + gender + A1 + L1a + L1b + Y1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span>
<span class="co">#&gt; Warning in CheckForVarianceWarning(inputs, g.ratio): Variance estimate is</span>
<span class="co">#&gt; based on influence curve only, which may be significantly anticonservative</span>
<span class="co">#&gt; because your data appears to contain positivity violations. Robust variance</span>
<span class="co">#&gt; estimate is not currently available with non binary outcomes but this will</span>
<span class="co">#&gt; be addressed in a future release.</span>
<span class="kw">summary</span>(result5b)
<span class="co">#&gt; Estimator:  tmle </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; ltmle(data = data, Anodes = c(3, 7), Lnodes = c(&quot;L1a&quot;, &quot;L1b&quot;, </span>
<span class="co">#&gt;     &quot;L2a&quot;, &quot;L2b&quot;), Ynodes = grep(&quot;^Y&quot;, names(data)), Qform = c(L1a = &quot;Q.kplus1 ~ 1&quot;, </span>
<span class="co">#&gt;     L2a = &quot;Q.kplus1 ~ 1&quot;), abar = c(1, 0))</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    Parameter Estimate:  0.90247 </span>
<span class="co">#&gt;     Estimated Std Err:  0.011971 </span>
<span class="co">#&gt;               p-value:  &lt;2e-16 </span>
<span class="co">#&gt;     95% Conf Interval: (0.87901, 0.92594)</span></code></pre></div>
<p>Gives the same result but prints a message saying some regression formulas will be dropped:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">result5c &lt;-<span class="st"> </span><span class="kw">ltmle</span>(data, <span class="dt">Anodes=</span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">7</span>), <span class="dt">Lnodes=</span><span class="kw">c</span>(<span class="st">&quot;L1a&quot;</span>, <span class="st">&quot;L1b&quot;</span>, <span class="st">&quot;L2a&quot;</span>, <span class="st">&quot;L2b&quot;</span>), 
 <span class="dt">Ynodes=</span><span class="kw">grep</span>(<span class="st">&quot;^Y&quot;</span>, <span class="kw">names</span>(data)), <span class="dt">abar=</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), 
 <span class="dt">Qform=</span><span class="kw">c</span>(<span class="dt">L1a=</span><span class="st">&quot;Q.kplus1 ~ 1&quot;</span>, <span class="dt">L1b=</span><span class="st">&quot;Q.klus1~A1&quot;</span>, 
 <span class="dt">Y1=</span><span class="st">&quot;Q.kplus1~L1a&quot;</span>, <span class="dt">L2a=</span><span class="st">&quot;Q.kplus1 ~ 1&quot;</span>, <span class="dt">L2b=</span><span class="st">&quot;Q.klus1~A1&quot;</span>, <span class="dt">Y2=</span><span class="st">&quot;Q.kplus1~A2 + gender&quot;</span>))
<span class="co">#&gt; L/Y nodes (after removing blocks)  : L1aL2a</span>
<span class="co">#&gt; Qform names                        : L1aL1bY1L2aL2bY2</span>
<span class="co">#&gt; The following nodes are not being considered as L/Y nodes because they are part of a block of L/Y nodes. They are being dropped from Qform:</span>
<span class="co">#&gt; L1b </span>
<span class="co">#&gt;  Y1 </span>
<span class="co">#&gt;  L2b </span>
<span class="co">#&gt;  Y2</span>
<span class="co">#&gt; gform not specified, using defaults:</span>
<span class="co">#&gt; formula for A1:</span>
<span class="co">#&gt; A1 ~ age + gender</span>
<span class="co">#&gt; formula for A2:</span>
<span class="co">#&gt; A2 ~ age + gender + A1 + L1a + L1b + Y1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span>
<span class="co">#&gt; Warning in CheckForVarianceWarning(inputs, g.ratio): Variance estimate is</span>
<span class="co">#&gt; based on influence curve only, which may be significantly anticonservative</span>
<span class="co">#&gt; because your data appears to contain positivity violations. Robust variance</span>
<span class="co">#&gt; estimate is not currently available with non binary outcomes but this will</span>
<span class="co">#&gt; be addressed in a future release.</span>
<span class="kw">summary</span>(result5c)
<span class="co">#&gt; Estimator:  tmle </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; ltmle(data = data, Anodes = c(3, 7), Lnodes = c(&quot;L1a&quot;, &quot;L1b&quot;, </span>
<span class="co">#&gt;     &quot;L2a&quot;, &quot;L2b&quot;), Ynodes = grep(&quot;^Y&quot;, names(data)), Qform = c(L1a = &quot;Q.kplus1 ~ 1&quot;, </span>
<span class="co">#&gt;     L1b = &quot;Q.klus1~A1&quot;, Y1 = &quot;Q.kplus1~L1a&quot;, L2a = &quot;Q.kplus1 ~ 1&quot;, </span>
<span class="co">#&gt;     L2b = &quot;Q.klus1~A1&quot;, Y2 = &quot;Q.kplus1~A2 + gender&quot;), abar = c(1, </span>
<span class="co">#&gt;     0))</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    Parameter Estimate:  0.90247 </span>
<span class="co">#&gt;     Estimated Std Err:  0.011971 </span>
<span class="co">#&gt;               p-value:  &lt;2e-16 </span>
<span class="co">#&gt;     95% Conf Interval: (0.87901, 0.92594)</span></code></pre></div>
<p>If there were a Anode or Cnode between L1b and Y1, Y1 would also need a Q regression formula.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
